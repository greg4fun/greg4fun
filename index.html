<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Tech notes and tips">
<meta name="viewport" content="width=device-width">
<title>Greg's Tech Notes</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://stencel.io/index.html">
<link rel="next" href="index-4.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link rel="prefetch" href="posts/kubernetes-iptables-changes-on-service-creation.html" type="text/html">
</head>
<body>
    <a href="#page-content" class="sr-only sr-only-focusable">Skip to main content</a>
    
    <section class="social"><ul>
<li><p style="color:#fff;font-size:3em;">stencel.io</p></li>
        <li><p style="color:#fff;font-size:2em;">greg's tech notes</p></li>
            <li>
                <a href="https://stencel.io/">
                    <img src="images/aboutme.png" alt="Greg's Tech Notes" id="logo"></a>
            </li>
        
            <li class="active"><a href="#" title="Home (active)"><i class="fa fa-home"></i></a></li>
            <li><a href="archive.html" title="Archives"><i class="fa fa-folder-open"></i></a></li>
            <li><a href="categories/index.html" title="Tags"><i class="fa fa-tags"></i></a></li>
            <li><a href="https://www.linkedin.com/in/gregstencel/" title="My Linkedin"><i class="fab fa-linkedin"></i></a></li>
            <li><a href="https://github.com/greg4fun" title="My Github"><i class="fab fa-github"></i></a></li>
    
    

        </ul></section><section class="page-content"><div class="content" rel="main">
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/kubernetes-iptables-changes-on-service-creation.html" class="u-url">Kubernetes iptables changes on service creation</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/kubernetes-iptables-changes-on-service-creation.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2021-04-14T21:37:51Z" title="2021-04-14 21:37">2021-04-14 21:37</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/kubernetes-iptables-changes-on-service-creation.html#disqus_thread" data-disqus-identifier="cache/posts/kubernetes-iptables-changes-on-service-creation.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>This is simple investigation on what happens with iptables on service creation with /and without targetport specified</p>
<p>I've been recently told by someone that using target port in service creates mess in iptables so I thought it will be
cool challenge to check if thats really the case.</p>
<p>I have used simple iptables-save to get whole iptables rules at once and then added service with targetport, then cleaned iptables by deleting service and
then did the same without targetport to compare what is being added to ipt.</p>
<p>Cluster specs:</p>
<ul class="simple">
<li><p>CPU ARCH: (x86) build with kubeadm:</p></li>
<li><p>CNI: Calico</p></li>
<li><p>KubeProxy mode: iptables</p></li>
<li><p>standard etcd</p></li>
</ul>
<div class="section" id="iptables-with-targetport-in-service">
<h2>IPtables with targetport in service</h2>
<pre class="code bash"><a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-1"></a>&gt; :KUBE-SEP-KVGH6HHOFLBGG2WW - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span> 184a186
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-2"></a>&gt; :KUBE-SVC-FOI3G5ZK27IESILB - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span> 201a204,205
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-3"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix-service"</span> -m tcp --dport <span class="m">31224</span> -j KUBE-MARK-MASQ
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-4"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix-service"</span> -m tcp --dport <span class="m">31224</span> -j KUBE-SVC-FOI3G5ZK27IESILB
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-5"></a>&gt; -A KUBE-SEP-KVGH6HHOFLBGG2WW -s <span class="m">10</span>.1.167.92/32 -m comment --comment <span class="s2">"default/ngnix-service"</span> -j KUBE-MARK-MASQ
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-6"></a>&gt; -A KUBE-SEP-KVGH6HHOFLBGG2WW -p tcp -m comment --comment <span class="s2">"default/ngnix-service"</span> -m tcp -j DNAT --to-destination <span class="m">10</span>.1.167.92:8000
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-7"></a>&gt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.105.57.223/32 -p tcp -m comment --comment <span class="s2">"default/ngnix-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-MARK-MASQ
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-8"></a>&gt; -A KUBE-SERVICES -d <span class="m">10</span>.105.57.223/32 -p tcp -m comment --comment <span class="s2">"default/ngnix-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-SVC-FOI3G5ZK27IESILB
<a name="rest_code_56a7d3775e5346dfb6276ad25d30fe98-9"></a>&gt; -A KUBE-SVC-FOI3G5ZK27IESILB -m comment --comment <span class="s2">"default/ngnix-service"</span> -j KUBE-SEP-KVGH6HHOFLBGG2WW
</pre>
<p>As we can see in the example above the rule is to destination nat pod IP 10.1.167.92 on the port 8000 which is target
port we have specified.</p>
</div>
<div class="section" id="iptables-without-targetport-in-service">
<h2>IPtables without targetport in service</h2>
<pre class="code bash"><a name="rest_code_097613f939b341e09b957d2673283c5d-1"></a>&gt; :KUBE-SEP-OP54BO3C6MKRBI5R - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_097613f939b341e09b957d2673283c5d-2"></a>&gt; :KUBE-SVC-FOI3G5ZK27IESILB - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_097613f939b341e09b957d2673283c5d-3"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix-service"</span> -m tcp --dport <span class="m">32681</span> -j KUBE-MARK-MASQ
<a name="rest_code_097613f939b341e09b957d2673283c5d-4"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix-service"</span> -m tcp --dport <span class="m">32681</span> -j KUBE-SVC-FOI3G5ZK27IESILB
<a name="rest_code_097613f939b341e09b957d2673283c5d-5"></a>&gt; -A KUBE-SEP-OP54BO3C6MKRBI5R -s <span class="m">10</span>.1.167.92/32 -m comment --comment <span class="s2">"default/ngnix-service"</span> -j KUBE-MARK-MASQ
<a name="rest_code_097613f939b341e09b957d2673283c5d-6"></a>&gt; -A KUBE-SEP-OP54BO3C6MKRBI5R -p tcp -m comment --comment <span class="s2">"default/ngnix-service"</span> -m tcp -j DNAT --to-destination <span class="m">10</span>.1.167.92:80
<a name="rest_code_097613f939b341e09b957d2673283c5d-7"></a>&lt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.96.0.1/32 -p tcp -m comment --comment <span class="s2">"default/kubernetes:https cluster IP"</span> -m tcp --dport <span class="m">443</span> -j KUBE-MARK-MASQ
<a name="rest_code_097613f939b341e09b957d2673283c5d-8"></a>&lt; -A KUBE-SERVICES -d <span class="m">10</span>.96.0.1/32 -p tcp -m comment --comment <span class="s2">"default/kubernetes:https cluster IP"</span> -m tcp --dport <span class="m">443</span> -j KUBE-SVC-NPX46M4PTMTKRN6Y
<a name="rest_code_097613f939b341e09b957d2673283c5d-9"></a>&lt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.96.0.10/32 -p tcp -m comment --comment <span class="s2">"kube-system/kube-dns:metrics cluster IP"</span> -m tcp --dport <span class="m">9153</span> -j KUBE-MARK-MASQ
<a name="rest_code_097613f939b341e09b957d2673283c5d-10"></a>&lt; -A KUBE-SERVICES -d <span class="m">10</span>.96.0.10/32 -p tcp -m comment --comment <span class="s2">"kube-system/kube-dns:metrics cluster IP"</span> -m tcp --dport <span class="m">9153</span> -j KUBE-SVC-JD5MR3NA4I4DYORP
<a name="rest_code_097613f939b341e09b957d2673283c5d-11"></a>&gt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.96.129.116/32 -p tcp -m comment --comment <span class="s2">"default/ngnix-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-MARK-MASQ
<a name="rest_code_097613f939b341e09b957d2673283c5d-12"></a>&gt; -A KUBE-SERVICES -d <span class="m">10</span>.96.129.116/32 -p tcp -m comment --comment <span class="s2">"default/ngnix-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-SVC-FOI3G5ZK27IESILB
<a name="rest_code_097613f939b341e09b957d2673283c5d-13"></a>&gt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.96.0.1/32 -p tcp -m comment --comment <span class="s2">"default/kubernetes:https cluster IP"</span> -m tcp --dport <span class="m">443</span> -j KUBE-MARK-MASQ
<a name="rest_code_097613f939b341e09b957d2673283c5d-14"></a>&gt; -A KUBE-SERVICES -d <span class="m">10</span>.96.0.1/32 -p tcp -m comment --comment <span class="s2">"default/kubernetes:https cluster IP"</span> -m tcp --dport <span class="m">443</span> -j KUBE-SVC-NPX46M4PTMTKRN6Y
<a name="rest_code_097613f939b341e09b957d2673283c5d-15"></a>&gt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.96.0.10/32 -p tcp -m comment --comment <span class="s2">"kube-system/kube-dns:metrics cluster IP"</span> -m tcp --dport <span class="m">9153</span> -j KUBE-MARK-MASQ
<a name="rest_code_097613f939b341e09b957d2673283c5d-16"></a>&gt; -A KUBE-SERVICES -d <span class="m">10</span>.96.0.10/32 -p tcp -m comment --comment <span class="s2">"kube-system/kube-dns:metrics cluster IP"</span> -m tcp --dport <span class="m">9153</span> -j KUBE-SVC-JD5MR3NA4I4DYORP
<a name="rest_code_097613f939b341e09b957d2673283c5d-17"></a>&gt; -A KUBE-SVC-FOI3G5ZK27IESILB -m comment --comment <span class="s2">"default/ngnix-service"</span> -j KUBE-SEP-OP54BO3C6MKRBI5R
</pre>
<p>In such simple setup I would say not providing the targetport makes even bigger mess.</p>
<p>Lets see something more sophisticated so deployment with 2 replicasets</p>
</div>
<div class="section" id="with-targetport">
<h2>With targetport:</h2>
<pre class="code bash"><a name="rest_code_6d830382eb804cfb81d31d4006e21df2-1"></a>&gt; :PREROUTING ACCEPT <span class="o">[</span><span class="m">4</span>:212<span class="o">]</span>
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-2"></a>&gt; :INPUT ACCEPT <span class="o">[</span><span class="m">4</span>:212<span class="o">]</span>
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-3"></a>&gt; :OUTPUT ACCEPT <span class="o">[</span><span class="m">29</span>:1740<span class="o">]</span>
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-4"></a>&gt; :POSTROUTING ACCEPT <span class="o">[</span><span class="m">29</span>:1740<span class="o">]</span>
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-5"></a>&gt; :KUBE-SEP-KCPMBF3JPX5ITGQR - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-6"></a>&gt; :KUBE-SEP-PPG4JXRVDYEFVT6U - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-7"></a>&gt; :KUBE-SVC-JSEMNMAXFXXWPYZQ - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-8"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp --dport <span class="m">30329</span> -j KUBE-MARK-MASQ
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-9"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp --dport <span class="m">30329</span> -j KUBE-SVC-JSEMNMAXFXXWPYZQ
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-10"></a>&gt; -A KUBE-SEP-KCPMBF3JPX5ITGQR -s <span class="m">10</span>.1.129.5/32 -m comment --comment <span class="s2">"default/ngnix2-service"</span> -j KUBE-MARK-MASQ
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-11"></a>&gt; -A KUBE-SEP-KCPMBF3JPX5ITGQR -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp -j DNAT --to-destination <span class="m">10</span>.1.129.5:8000
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-12"></a>&gt; -A KUBE-SEP-PPG4JXRVDYEFVT6U -s <span class="m">10</span>.1.167.83/32 -m comment --comment <span class="s2">"default/ngnix2-service"</span> -j KUBE-MARK-MASQ
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-13"></a>&gt; -A KUBE-SEP-PPG4JXRVDYEFVT6U -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp -j DNAT --to-destination <span class="m">10</span>.1.167.83:8000
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-14"></a>&gt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.98.111.212/32 -p tcp -m comment --comment <span class="s2">"default/ngnix2-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-MARK-MASQ
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-15"></a>&gt; -A KUBE-SERVICES -d <span class="m">10</span>.98.111.212/32 -p tcp -m comment --comment <span class="s2">"default/ngnix2-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-SVC-JSEMNMAXFXXWPYZQ
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-16"></a>&gt; -A KUBE-SVC-JSEMNMAXFXXWPYZQ -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m statistic --mode random --probability <span class="m">0</span>.50000000000 -j KUBE-SEP-KCPMBF3JPX5ITGQR
<a name="rest_code_6d830382eb804cfb81d31d4006e21df2-17"></a>&gt; -A KUBE-SVC-JSEMNMAXFXXWPYZQ -m comment --comment <span class="s2">"default/ngnix2-service"</span> -j KUBE-SEP-PPG4JXRVDYEFVT6U
</pre>
<p>From the following we can spot that each for our label selector in the service is listed here,
which absolutely makes sense how kube proxy would know where to send packets if not that.</p>
<p>Ok lets try with replicas without providing the port:</p>
</div>
<div class="section" id="without-targetport">
<h2>Without targetport:</h2>
<pre class="code bash"><a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-1"></a>&gt; :PREROUTING ACCEPT <span class="o">[</span><span class="m">4</span>:252<span class="o">]</span>
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-2"></a>&gt; :INPUT ACCEPT <span class="o">[</span><span class="m">4</span>:252<span class="o">]</span>
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-3"></a>&gt; :OUTPUT ACCEPT <span class="o">[</span><span class="m">25</span>:1500<span class="o">]</span>
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-4"></a>&gt; :POSTROUTING ACCEPT <span class="o">[</span><span class="m">25</span>:1500<span class="o">]</span>
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-5"></a>&gt; :KUBE-SEP-NK6MJN7AMVFQPBDQ - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-6"></a>&gt; :KUBE-SEP-ZX65TQ3QUDHUAQQM - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-7"></a>&gt; :KUBE-SVC-JSEMNMAXFXXWPYZQ - <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-8"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp --dport <span class="m">31277</span> -j KUBE-MARK-MASQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-9"></a>&gt; -A KUBE-NODEPORTS -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp --dport <span class="m">31277</span> -j KUBE-SVC-JSEMNMAXFXXWPYZQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-10"></a>&gt; -A KUBE-SEP-NK6MJN7AMVFQPBDQ -s <span class="m">10</span>.1.129.5/32 -m comment --comment <span class="s2">"default/ngnix2-service"</span> -j KUBE-MARK-MASQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-11"></a>&gt; -A KUBE-SEP-NK6MJN7AMVFQPBDQ -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp -j DNAT --to-destination <span class="m">10</span>.1.129.5:80
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-12"></a>&lt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.96.0.10/32 -p udp -m comment --comment <span class="s2">"kube-system/kube-dns:dns cluster IP"</span> -m udp --dport <span class="m">53</span> -j KUBE-MARK-MASQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-13"></a>&lt; -A KUBE-SERVICES -d <span class="m">10</span>.96.0.10/32 -p udp -m comment --comment <span class="s2">"kube-system/kube-dns:dns cluster IP"</span> -m udp --dport <span class="m">53</span> -j KUBE-SVC-TCOU7JCQXEZGVUNU
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-14"></a>---
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-15"></a>&gt; -A KUBE-SEP-ZX65TQ3QUDHUAQQM -s <span class="m">10</span>.1.167.83/32 -m comment --comment <span class="s2">"default/ngnix2-service"</span> -j KUBE-MARK-MASQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-16"></a>&gt; -A KUBE-SEP-ZX65TQ3QUDHUAQQM -p tcp -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m tcp -j DNAT --to-destination <span class="m">10</span>.1.167.83:80
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-17"></a>&gt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.108.13.83/32 -p tcp -m comment --comment <span class="s2">"default/ngnix2-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-MARK-MASQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-18"></a>&gt; -A KUBE-SERVICES -d <span class="m">10</span>.108.13.83/32 -p tcp -m comment --comment <span class="s2">"default/ngnix2-service cluster IP"</span> -m tcp --dport <span class="m">80</span> -j KUBE-SVC-JSEMNMAXFXXWPYZQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-19"></a>&gt; -A KUBE-SERVICES ! -s <span class="m">192</span>.168.0.0/16 -d <span class="m">10</span>.96.0.10/32 -p udp -m comment --comment <span class="s2">"kube-system/kube-dns:dns cluster IP"</span> -m udp --dport <span class="m">53</span> -j KUBE-MARK-MASQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-20"></a>&gt; -A KUBE-SERVICES -d <span class="m">10</span>.96.0.10/32 -p udp -m comment --comment <span class="s2">"kube-system/kube-dns:dns cluster IP"</span> -m udp --dport <span class="m">53</span> -j KUBE-SVC-TCOU7JCQXEZGVUNU
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-21"></a>&gt; -A KUBE-SVC-JSEMNMAXFXXWPYZQ -m comment --comment <span class="s2">"default/ngnix2-service"</span> -m statistic --mode random --probability <span class="m">0</span>.50000000000 -j KUBE-SEP-NK6MJN7AMVFQPBDQ
<a name="rest_code_766e25573fbb4cb7b526a2578c187fa8-22"></a>&gt; -A KUBE-SVC-JSEMNMAXFXXWPYZQ -m comment --comment <span class="s2">"default/ngnix2-service"</span> -j KUBE-SEP-ZX65TQ3QUDHUAQQM
</pre>
<p>This needs proper investigation from me but for now what I can see
by not providing target port the iptables rules are interfering with more components like kube-dns
and  by providing the targetport its not touching kube-dns</p>
<p>To be continued...</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/kubernetes-etcd-whats-inside.html" class="u-url">Kubernetes etcd - what's inside?</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/kubernetes-etcd-whats-inside.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2021-04-10T12:17:23Z" title="2021-04-10 12:17">2021-04-10 12:17</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/kubernetes-etcd-whats-inside.html#disqus_thread" data-disqus-identifier="cache/posts/kubernetes-etcd-whats-inside.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="what-s-etcd-and-what-part-does-it-play-in-kubernetes">
<h2>What's etcd and what part does it play in kubernetes?</h2>
<p>ETCD is an open source distributed key-value store. In kubernetes it is a "single point of truth" as well as "single point of failure", it is the "definition of the cluster" as it holds it's configuration and status so it's best to have it replicated.</p>
<p>There are of course alternatives like <a class="reference external" href="https://www.consul.io/">consul</a> , <a class="reference external" href="https://zookeeper.apache.org/">zookeeper</a> , <a class="reference external" href="https://github.com/ha/doozerd/">doozerd</a> , but I can't tell anything about them yet as haven't tried them (there are a lot of comparisons on the web already).</p>
<p>I was always curious how it's structured, also it's good to know how it works from admin point of view this could help to simulate some etcd failure/corruption/snapshot and restore.</p>
<p>To play with your etcd (remember you can destroy your cluster so just bear in mind to make read operations only and dont
play with production one unless you know what you are doing).</p>
<p>We can do it using etcdclient locally (described in the bottom ) or eve easier - through etcd pod.</p>
</div>
<div class="section" id="accessing-etcd-through-etcd-pod">
<h2>Accessing etcd through etcd pod</h2>
<pre class="code bash"><a name="rest_code_f38496c8a8d746bdbcc14817caec85de-1"></a>kubectl get pods -n kube-system -l <span class="nv">component</span><span class="o">=</span>etcd
<a name="rest_code_f38496c8a8d746bdbcc14817caec85de-2"></a>
<a name="rest_code_f38496c8a8d746bdbcc14817caec85de-3"></a>NAME                READY   STATUS    RESTARTS   AGE
<a name="rest_code_f38496c8a8d746bdbcc14817caec85de-4"></a>etcd-lenovo-node1   <span class="m">1</span>/1     Running   <span class="m">0</span>          47d
</pre>
<p>I now know my etcd pods name is "etcd-lenovo-node1" so I can execute etcdctl on it now.</p>
<p>Checking etcd instances</p>
<pre class="code bash"><a name="rest_code_e96b71a220f7483fb74624dc2a45d0b5-1"></a>kubectl <span class="nb">exec</span> -it etcd-lenovo-node1 -n kube-system -- /bin/sh -c <span class="s2">"ETCDCTL_API=3 etcdctl \</span>
<a name="rest_code_e96b71a220f7483fb74624dc2a45d0b5-2"></a><span class="s2">--endpoints=https://127.0.0.1:2379 \</span>
<a name="rest_code_e96b71a220f7483fb74624dc2a45d0b5-3"></a><span class="s2">--cacert=/etc/kubernetes/pki/etcd/ca.crt \</span>
<a name="rest_code_e96b71a220f7483fb74624dc2a45d0b5-4"></a><span class="s2">--cert=/etc/kubernetes/pki/etcd/server.crt \</span>
<a name="rest_code_e96b71a220f7483fb74624dc2a45d0b5-5"></a><span class="s2">--key=/etc/kubernetes/pki/etcd/server.key \</span>
<a name="rest_code_e96b71a220f7483fb74624dc2a45d0b5-6"></a><span class="s2">member list"</span>
</pre>
<p>For the reference we will get all keys:</p>
<pre class="code bash"><a name="rest_code_c724a7bfe52e4f2e97447763660007ed-1"></a>kubectl <span class="nb">exec</span> -it etcd-lenovo-node1 -n kube-system -- /bin/sh -c <span class="s2">"ETCDCTL_API=3 etcdctl \</span>
<a name="rest_code_c724a7bfe52e4f2e97447763660007ed-2"></a><span class="s2">--endpoints=https://127.0.0.1:2379 \</span>
<a name="rest_code_c724a7bfe52e4f2e97447763660007ed-3"></a><span class="s2">--cacert=/etc/kubernetes/pki/etcd/ca.crt \</span>
<a name="rest_code_c724a7bfe52e4f2e97447763660007ed-4"></a><span class="s2">--cert=/etc/kubernetes/pki/etcd/server.crt \</span>
<a name="rest_code_c724a7bfe52e4f2e97447763660007ed-5"></a><span class="s2">--key=/etc/kubernetes/pki/etcd/server.key \</span>
<a name="rest_code_c724a7bfe52e4f2e97447763660007ed-6"></a><span class="s2">get / --prefix --keys-only"</span>
</pre>
<p>Output:</p>
<pre class="code yaml"><a name="rest_code_6cb74830316f412aa8617289a29f16a3-1"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/assignment/ipv4/block/10.1.129.0-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-2"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/assignment/ipv4/block/10.1.161.128-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-3"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/assignment/ipv4/block/10.1.167.64-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-4"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/assignment/ipv4/block/10.1.46.192-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-5"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/ipip-tunnel-addr-lenovo-master</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-6"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/ipip-tunnel-addr-lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-7"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/ipip-tunnel-addr-lenovo-node2</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-8"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/ipip-tunnel-addr-lenovo-node3</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-9"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.066670f1f4cbac2f254078fa523c2351ff43d43f37ef279d077ca9e537363367</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-10"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.0854af62bdae13df75426ab9f0930045e527203c6a70863a1e6ac419dde92755</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-11"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.2ea6c7186cce92fcf37c68cba1013975f8144a36c24580133cdae1d2a5c81824</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-12"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.7b253e73a58302b7bd365f748085eddb7a88b73770f09981e4edcf743fca103e</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-13"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.7d44b409803e0297e38af4571fda00f7f50858fcd6b51556f94ac08561f41415</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-14"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.81ee68186cf6390521b6f7211804959de7dd61526b0fa50a62be68bdcdff3348</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-15"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.81f75b846e0b01c2756c6de53cb5ede58dcd2f08cfc0fb82b44dbbc41cb3cd83</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-16"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.84122c67c08645bcdc8e05024086caa16ec841018b01ed7f15bd29d837653d7f</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-17"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.c5942bdcf48ee4971952d449db73e4130aa7f57719d48159611ba1591f2aa5e8</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-18"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/handle/k8s-pod-network.de3addbfdb7c67b750b074a04d82753a3184d963255c349ed15a63597a6e7dd6</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-19"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/host/lenovo-master/ipv4/block/10.1.46.192-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-20"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/host/lenovo-node1/ipv4/block/10.1.161.128-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-21"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/host/lenovo-node2/ipv4/block/10.1.167.64-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-22"></a><span class="l l-Scalar l-Scalar-Plain">/calico/ipam/v2/host/lenovo-node3/ipv4/block/10.1.129.0-26</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-23"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/clusterinformations/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-24"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/felixconfigurations/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-25"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/felixconfigurations/node.lenovo-master</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-26"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/felixconfigurations/node.lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-27"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/felixconfigurations/node.lenovo-node2</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-28"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/felixconfigurations/node.lenovo-node3</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-29"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/ippools/default-ipv4-ippool</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-30"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/kubecontrollersconfigurations/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-31"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/nodes/lenovo-master</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-32"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/nodes/lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-33"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/nodes/lenovo-node2</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-34"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/nodes/lenovo-node3</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-35"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/kns.default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-36"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/kns.kube-node-lease</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-37"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/kns.kube-public</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-38"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/kns.kube-system</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-39"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/kns.metallb-system</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-40"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/kns.quota-mem-cpu</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-41"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.default.default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-42"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-node-lease.default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-43"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-public.default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-44"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.attachdetach-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-45"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.bootstrap-signer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-46"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.calico-kube-controllers</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-47"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.calico-node</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-48"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.certificate-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-49"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.clusterrole-aggregation-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-50"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.coredns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-51"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.cronjob-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-52"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.daemon-set-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-53"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-54"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.deployment-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-55"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.disruption-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-56"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.endpoint-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-57"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.endpointslice-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-58"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.endpointslicemirroring-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-59"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.expand-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-60"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.generic-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-61"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.horizontal-pod-autoscaler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-62"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.job-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-63"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.kube-proxy</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-64"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.metrics-server</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-65"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.namespace-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-66"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.node-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-67"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.persistent-volume-binder</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-68"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.pod-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-69"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.pv-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-70"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.pvc-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-71"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.replicaset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-72"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.replication-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-73"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.resourcequota-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-74"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.root-ca-cert-publisher</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-75"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.service-account-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-76"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.service-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-77"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.statefulset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-78"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.token-cleaner</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-79"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.kube-system.ttl-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-80"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.metallb-system.controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-81"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.metallb-system.default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-82"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/profiles/ksa.metallb-system.speaker</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-83"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/default/lenovo--master-k8s-nginx--hpa--6c4758554f--99h7l-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-84"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/default/lenovo--master-k8s-nginx--hpa--6c4758554f--tqrp9-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-85"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/default/lenovo--master-k8s-nginx--hpa--6c4758554f--zf4rd-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-86"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/default/lenovo--node2-k8s-ng-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-87"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/default/lenovo--node2-k8s-nginx--b4c9f744d--6fqjs-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-88"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/default/lenovo--node2-k8s-nginx--b4c9f744d--hvdsh-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-89"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/kube-system/lenovo--master-k8s-metrics--server--666b5bc478--8624s-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-90"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/kube-system/lenovo--node1-k8s-coredns--74ff55c5b--n942q-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-91"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/kube-system/lenovo--node1-k8s-coredns--74ff55c5b--vnm7t-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-92"></a><span class="l l-Scalar l-Scalar-Plain">/calico/resources/v3/projectcalico.org/workloadendpoints/metallb-system/lenovo--node3-k8s-controller--65db86ddc6--q6zvx-eth0</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-93"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-94"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.admissionregistration.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-95"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.apiextensions.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-96"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.apps</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-97"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.authentication.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-98"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.authorization.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-99"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.autoscaling</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-100"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.batch</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-101"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.certificates.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-102"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.coordination.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-103"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.events.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-104"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.networking.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-105"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.node.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-106"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.rbac.authorization.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-107"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.scheduling.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-108"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1.storage.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-109"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.admissionregistration.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-110"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.apiextensions.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-111"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.authentication.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-112"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.authorization.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-113"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.batch</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-114"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.certificates.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-115"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.coordination.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-116"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.discovery.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-117"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.events.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-118"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.extensions</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-119"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.flowcontrol.apiserver.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-120"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.metrics.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-121"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.networking.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-122"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.node.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-123"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.policy</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-124"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.rbac.authorization.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-125"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.scheduling.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-126"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v1beta1.storage.k8s.io</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-127"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v2beta1.autoscaling</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-128"></a><span class="l l-Scalar l-Scalar-Plain">/registry/apiregistration.k8s.io/apiservices/v2beta2.autoscaling</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-129"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/calico-kube-controllers</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-130"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/calico-node</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-131"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/cluster-admin</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-132"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/kubeadm:get-nodes</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-133"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/kubeadm:kubelet-bootstrap</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-134"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/kubeadm:node-autoapprove-bootstrap</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-135"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/kubeadm:node-autoapprove-certificate-rotation</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-136"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/kubeadm:node-proxier</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-137"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/metallb-system:controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-138"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/metallb-system:speaker</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-139"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/metrics-server:system:auth-delegator</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-140"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:basic-user</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-141"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:attachdetach-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-142"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:certificate-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-143"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:clusterrole-aggregation-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-144"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:cronjob-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-145"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:daemon-set-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-146"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:deployment-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-147"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:disruption-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-148"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:endpoint-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-149"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:endpointslice-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-150"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:endpointslicemirroring-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-151"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:expand-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-152"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:generic-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-153"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:horizontal-pod-autoscaler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-154"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:job-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-155"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:namespace-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-156"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:node-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-157"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:persistent-volume-binder</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-158"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:pod-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-159"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:pv-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-160"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:pvc-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-161"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:replicaset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-162"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:replication-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-163"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:resourcequota-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-164"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:root-ca-cert-publisher</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-165"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:route-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-166"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:service-account-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-167"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:service-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-168"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:statefulset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-169"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:controller:ttl-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-170"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:coredns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-171"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:discovery</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-172"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:kube-controller-manager</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-173"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:kube-dns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-174"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:kube-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-175"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:metrics-server</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-176"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:monitoring</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-177"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:node</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-178"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:node-proxier</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-179"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:public-info-viewer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-180"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:service-account-issuer-discovery</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-181"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterrolebindings/system:volume-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-182"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/admin</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-183"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/calico-kube-controllers</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-184"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/calico-node</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-185"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/cluster-admin</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-186"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/edit</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-187"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/kubeadm:get-nodes</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-188"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/metallb-system:controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-189"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/metallb-system:speaker</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-190"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:aggregate-to-admin</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-191"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:aggregate-to-edit</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-192"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:aggregate-to-view</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-193"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:aggregated-metrics-reader</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-194"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:auth-delegator</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-195"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:basic-user</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-196"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:certificates.k8s.io:certificatesigningrequests:nodeclient</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-197"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:certificates.k8s.io:certificatesigningrequests:selfnodeclient</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-198"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:certificates.k8s.io:kube-apiserver-client-approver</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-199"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:certificates.k8s.io:kube-apiserver-client-kubelet-approver</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-200"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:certificates.k8s.io:kubelet-serving-approver</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-201"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:certificates.k8s.io:legacy-unknown-approver</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-202"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:attachdetach-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-203"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:certificate-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-204"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:clusterrole-aggregation-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-205"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:cronjob-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-206"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:daemon-set-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-207"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:deployment-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-208"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:disruption-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-209"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:endpoint-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-210"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:endpointslice-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-211"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:endpointslicemirroring-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-212"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:expand-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-213"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:generic-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-214"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:horizontal-pod-autoscaler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-215"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:job-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-216"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:namespace-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-217"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:node-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-218"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:persistent-volume-binder</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-219"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:pod-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-220"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:pv-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-221"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:pvc-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-222"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:replicaset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-223"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:replication-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-224"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:resourcequota-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-225"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:root-ca-cert-publisher</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-226"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:route-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-227"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:service-account-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-228"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:service-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-229"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:statefulset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-230"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:controller:ttl-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-231"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:coredns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-232"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:discovery</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-233"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:heapster</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-234"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:kube-aggregator</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-235"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:kube-controller-manager</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-236"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:kube-dns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-237"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:kube-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-238"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:kubelet-api-admin</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-239"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:metrics-server</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-240"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:monitoring</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-241"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:node</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-242"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:node-bootstrapper</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-243"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:node-problem-detector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-244"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:node-proxier</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-245"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:persistent-volume-provisioner</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-246"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:public-info-viewer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-247"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:service-account-issuer-discovery</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-248"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/system:volume-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-249"></a><span class="l l-Scalar l-Scalar-Plain">/registry/clusterroles/view</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-250"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/default/cfindex</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-251"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/default/kube-root-ca.crt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-252"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-node-lease/kube-root-ca.crt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-253"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-public/cluster-info</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-254"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-public/kube-root-ca.crt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-255"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-system/calico-config</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-256"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-system/coredns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-257"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-system/extension-apiserver-authentication</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-258"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-system/kube-proxy</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-259"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-system/kube-root-ca.crt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-260"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-system/kubeadm-config</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-261"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/kube-system/kubelet-config-1.20</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-262"></a><span class="l l-Scalar l-Scalar-Plain">/registry/configmaps/metallb-system/kube-root-ca.crt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-263"></a><span class="l l-Scalar l-Scalar-Plain">/registry/controllerrevisions/kube-system/calico-node-849b8dc6bf</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-264"></a><span class="l l-Scalar l-Scalar-Plain">/registry/controllerrevisions/kube-system/kube-proxy-9978ddf98</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-265"></a><span class="l l-Scalar l-Scalar-Plain">/registry/controllerrevisions/metallb-system/speaker-55466f8f44</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-266"></a><span class="l l-Scalar l-Scalar-Plain">/registry/csinodes/lenovo-master</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-267"></a><span class="l l-Scalar l-Scalar-Plain">/registry/csinodes/lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-268"></a><span class="l l-Scalar l-Scalar-Plain">/registry/csinodes/lenovo-node2</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-269"></a><span class="l l-Scalar l-Scalar-Plain">/registry/csinodes/lenovo-node3</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-270"></a><span class="l l-Scalar l-Scalar-Plain">/registry/daemonsets/kube-system/calico-node</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-271"></a><span class="l l-Scalar l-Scalar-Plain">/registry/daemonsets/kube-system/kube-proxy</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-272"></a><span class="l l-Scalar l-Scalar-Plain">/registry/daemonsets/metallb-system/speaker</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-273"></a><span class="l l-Scalar l-Scalar-Plain">/registry/deployments/default/nginx</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-274"></a><span class="l l-Scalar l-Scalar-Plain">/registry/deployments/kube-system/calico-kube-controllers</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-275"></a><span class="l l-Scalar l-Scalar-Plain">/registry/deployments/kube-system/coredns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-276"></a><span class="l l-Scalar l-Scalar-Plain">/registry/deployments/kube-system/metrics-server</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-277"></a><span class="l l-Scalar l-Scalar-Plain">/registry/deployments/metallb-system/controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-278"></a><span class="l l-Scalar l-Scalar-Plain">/registry/endpointslices/default/kubernetes</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-279"></a><span class="l l-Scalar l-Scalar-Plain">/registry/endpointslices/default/nginx-gr59r</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-280"></a><span class="l l-Scalar l-Scalar-Plain">/registry/endpointslices/default/ngnix-service-sffvv</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-281"></a><span class="l l-Scalar l-Scalar-Plain">/registry/endpointslices/default/test1-fv4vr</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-282"></a><span class="l l-Scalar l-Scalar-Plain">/registry/endpointslices/kube-system/kube-dns-hjqkv</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-283"></a><span class="l l-Scalar l-Scalar-Plain">/registry/endpointslices/kube-system/kubelet-2fkdq</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-284"></a><span class="l l-Scalar l-Scalar-Plain">/registry/endpointslices/kube-system/metrics-server-j47kl</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-285"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/catch-all</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-286"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/exempt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-287"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/global-default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-288"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/kube-controller-manager</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-289"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/kube-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-290"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/kube-system-service-accounts</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-291"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/service-accounts</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-292"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/system-leader-election</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-293"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/system-nodes</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-294"></a><span class="l l-Scalar l-Scalar-Plain">/registry/flowschemas/workload-leader-election</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-295"></a><span class="l l-Scalar l-Scalar-Plain">/registry/leases/kube-node-lease/lenovo-master</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-296"></a><span class="l l-Scalar l-Scalar-Plain">/registry/leases/kube-node-lease/lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-297"></a><span class="l l-Scalar l-Scalar-Plain">/registry/leases/kube-node-lease/lenovo-node2</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-298"></a><span class="l l-Scalar l-Scalar-Plain">/registry/leases/kube-node-lease/lenovo-node3</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-299"></a><span class="l l-Scalar l-Scalar-Plain">/registry/leases/kube-system/kube-controller-manager</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-300"></a><span class="l l-Scalar l-Scalar-Plain">/registry/leases/kube-system/kube-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-301"></a><span class="l l-Scalar l-Scalar-Plain">/registry/masterleases/192.168.1.131</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-302"></a><span class="l l-Scalar l-Scalar-Plain">/registry/minions/lenovo-master</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-303"></a><span class="l l-Scalar l-Scalar-Plain">/registry/minions/lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-304"></a><span class="l l-Scalar l-Scalar-Plain">/registry/minions/lenovo-node2</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-305"></a><span class="l l-Scalar l-Scalar-Plain">/registry/minions/lenovo-node3</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-306"></a><span class="l l-Scalar l-Scalar-Plain">/registry/namespaces/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-307"></a><span class="l l-Scalar l-Scalar-Plain">/registry/namespaces/kube-node-lease</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-308"></a><span class="l l-Scalar l-Scalar-Plain">/registry/namespaces/kube-public</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-309"></a><span class="l l-Scalar l-Scalar-Plain">/registry/namespaces/kube-system</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-310"></a><span class="l l-Scalar l-Scalar-Plain">/registry/namespaces/metallb-system</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-311"></a><span class="l l-Scalar l-Scalar-Plain">/registry/namespaces/quota-mem-cpu</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-312"></a><span class="l l-Scalar l-Scalar-Plain">/registry/poddisruptionbudgets/kube-system/calico-kube-controllers</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-313"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/default/ng</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-314"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/default/nginx-b4c9f744d-6fqjs</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-315"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/default/nginx-b4c9f744d-hvdsh</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-316"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/default/nginx-hpa-6c4758554f-99h7l</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-317"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/default/nginx-hpa-6c4758554f-tqrp9</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-318"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/default/nginx-hpa-6c4758554f-zf4rd</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-319"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/calico-kube-controllers-664b5654ff-lmfjw</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-320"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/calico-node-6vtln</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-321"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/calico-node-9psrj</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-322"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/calico-node-n64kf</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-323"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/calico-node-s4gnp</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-324"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/coredns-74ff55c5b-n942q</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-325"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/coredns-74ff55c5b-vnm7t</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-326"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/etcd-lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-327"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/kube-apiserver-lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-328"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/kube-controller-manager-lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-329"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/kube-proxy-dxtr2</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-330"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/kube-proxy-r7jpl</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-331"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/kube-proxy-sb4b6</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-332"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/kube-proxy-v9xck</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-333"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/kube-scheduler-lenovo-node1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-334"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/kube-system/metrics-server-666b5bc478-8624s</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-335"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/metallb-system/controller-65db86ddc6-q6zvx</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-336"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/metallb-system/speaker-6mzwx</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-337"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/metallb-system/speaker-btrtz</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-338"></a><span class="l l-Scalar l-Scalar-Plain">/registry/pods/metallb-system/speaker-pxf28</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-339"></a><span class="l l-Scalar l-Scalar-Plain">/registry/podsecuritypolicy/controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-340"></a><span class="l l-Scalar l-Scalar-Plain">/registry/podsecuritypolicy/speaker</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-341"></a><span class="l l-Scalar l-Scalar-Plain">/registry/priorityclasses/system-cluster-critical</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-342"></a><span class="l l-Scalar l-Scalar-Plain">/registry/priorityclasses/system-node-critical</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-343"></a><span class="l l-Scalar l-Scalar-Plain">/registry/prioritylevelconfigurations/catch-all</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-344"></a><span class="l l-Scalar l-Scalar-Plain">/registry/prioritylevelconfigurations/exempt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-345"></a><span class="l l-Scalar l-Scalar-Plain">/registry/prioritylevelconfigurations/global-default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-346"></a><span class="l l-Scalar l-Scalar-Plain">/registry/prioritylevelconfigurations/leader-election</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-347"></a><span class="l l-Scalar l-Scalar-Plain">/registry/prioritylevelconfigurations/system</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-348"></a><span class="l l-Scalar l-Scalar-Plain">/registry/prioritylevelconfigurations/workload-high</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-349"></a><span class="l l-Scalar l-Scalar-Plain">/registry/prioritylevelconfigurations/workload-low</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-350"></a><span class="l l-Scalar l-Scalar-Plain">/registry/ranges/serviceips</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-351"></a><span class="l l-Scalar l-Scalar-Plain">/registry/ranges/servicenodeports</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-352"></a><span class="l l-Scalar l-Scalar-Plain">/registry/replicasets/default/nginx-6799fc88d8</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-353"></a><span class="l l-Scalar l-Scalar-Plain">/registry/replicasets/default/nginx-6c54d6848f</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-354"></a><span class="l l-Scalar l-Scalar-Plain">/registry/replicasets/default/nginx-b4c9f744d</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-355"></a><span class="l l-Scalar l-Scalar-Plain">/registry/replicasets/kube-system/calico-kube-controllers-664b5654ff</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-356"></a><span class="l l-Scalar l-Scalar-Plain">/registry/replicasets/kube-system/coredns-74ff55c5b</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-357"></a><span class="l l-Scalar l-Scalar-Plain">/registry/replicasets/kube-system/metrics-server-666b5bc478</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-358"></a><span class="l l-Scalar l-Scalar-Plain">/registry/replicasets/metallb-system/controller-65db86ddc6</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-359"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-public/kubeadm:bootstrap-signer-clusterinfo</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-360"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-public/system:controller:bootstrap-signer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-361"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/kube-proxy</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-362"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/kubeadm:kubelet-config-1.20</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-363"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/kubeadm:nodes-kubeadm-config</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-364"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/metrics-server-auth-reader</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-365"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/system::extension-apiserver-authentication-reader</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-366"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/system::leader-locking-kube-controller-manager</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-367"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/system::leader-locking-kube-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-368"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/system:controller:bootstrap-signer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-369"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/system:controller:cloud-provider</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-370"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/kube-system/system:controller:token-cleaner</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-371"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/metallb-system/config-watcher</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-372"></a><span class="l l-Scalar l-Scalar-Plain">/registry/rolebindings/metallb-system/pod-lister</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-373"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-public/kubeadm:bootstrap-signer-clusterinfo</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-374"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-public/system:controller:bootstrap-signer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-375"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/extension-apiserver-authentication-reader</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-376"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/kube-proxy</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-377"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/kubeadm:kubelet-config-1.20</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-378"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/kubeadm:nodes-kubeadm-config</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-379"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/system::leader-locking-kube-controller-manager</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-380"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/system::leader-locking-kube-scheduler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-381"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/system:controller:bootstrap-signer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-382"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/system:controller:cloud-provider</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-383"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/kube-system/system:controller:token-cleaner</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-384"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/metallb-system/config-watcher</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-385"></a><span class="l l-Scalar l-Scalar-Plain">/registry/roles/metallb-system/pod-lister</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-386"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/default/default-token-qknwm</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-387"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-node-lease/default-token-xhxwz</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-388"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-public/default-token-767ld</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-389"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/attachdetach-controller-token-rm5kc</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-390"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/bootstrap-signer-token-fwnzd</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-391"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/calico-etcd-secrets</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-392"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/calico-kube-controllers-token-h4trc</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-393"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/calico-node-token-js7t8</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-394"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/certificate-controller-token-pk96t</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-395"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/clusterrole-aggregation-controller-token-xxb5s</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-396"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/coredns-token-b2z2f</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-397"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/cronjob-controller-token-54p6d</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-398"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/daemon-set-controller-token-sbtsk</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-399"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/default-token-9fhbc</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-400"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/deployment-controller-token-swxcw</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-401"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/disruption-controller-token-2rr6w</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-402"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/endpoint-controller-token-fmjrz</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-403"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/endpointslice-controller-token-sbn6n</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-404"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/endpointslicemirroring-controller-token-qrld7</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-405"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/expand-controller-token-tfgpk</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-406"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/generic-garbage-collector-token-nc855</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-407"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/horizontal-pod-autoscaler-token-h8rl9</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-408"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/job-controller-token-d7lnj</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-409"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/kube-proxy-token-9snst</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-410"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/metrics-server-token-szltz</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-411"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/namespace-controller-token-rwn7m</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-412"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/node-controller-token-zqvxv</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-413"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/persistent-volume-binder-token-6vj8p</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-414"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/pod-garbage-collector-token-77gp8</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-415"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/pv-protection-controller-token-49c2m</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-416"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/pvc-protection-controller-token-twhrk</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-417"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/replicaset-controller-token-d4bzb</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-418"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/replication-controller-token-7mprg</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-419"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/resourcequota-controller-token-x97qt</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-420"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/root-ca-cert-publisher-token-gr4cq</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-421"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/service-account-controller-token-46wxl</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-422"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/service-controller-token-dbnc5</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-423"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/statefulset-controller-token-fxblr</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-424"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/token-cleaner-token-c48kq</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-425"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/kube-system/ttl-controller-token-q5wmc</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-426"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/metallb-system/controller-token-9vrqd</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-427"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/metallb-system/default-token-9jw8j</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-428"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/metallb-system/memberlist</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-429"></a><span class="l l-Scalar l-Scalar-Plain">/registry/secrets/metallb-system/speaker-token-d6b7b</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-430"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/default/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-431"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-node-lease/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-432"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-public/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-433"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/attachdetach-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-434"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/bootstrap-signer</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-435"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/calico-kube-controllers</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-436"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/calico-node</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-437"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/certificate-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-438"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/clusterrole-aggregation-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-439"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/coredns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-440"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/cronjob-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-441"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/daemon-set-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-442"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-443"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/deployment-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-444"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/disruption-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-445"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/endpoint-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-446"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/endpointslice-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-447"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/endpointslicemirroring-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-448"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/expand-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-449"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/generic-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-450"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/horizontal-pod-autoscaler</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-451"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/job-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-452"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/kube-proxy</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-453"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/metrics-server</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-454"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/namespace-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-455"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/node-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-456"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/persistent-volume-binder</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-457"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/pod-garbage-collector</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-458"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/pv-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-459"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/pvc-protection-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-460"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/replicaset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-461"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/replication-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-462"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/resourcequota-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-463"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/root-ca-cert-publisher</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-464"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/service-account-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-465"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/service-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-466"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/statefulset-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-467"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/token-cleaner</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-468"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/kube-system/ttl-controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-469"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/metallb-system/controller</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-470"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/metallb-system/default</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-471"></a><span class="l l-Scalar l-Scalar-Plain">/registry/serviceaccounts/metallb-system/speaker</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-472"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/endpoints/default/kubernetes</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-473"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/endpoints/default/nginx</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-474"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/endpoints/default/ngnix-service</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-475"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/endpoints/default/test1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-476"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/endpoints/kube-system/kube-dns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-477"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/endpoints/kube-system/kubelet</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-478"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/endpoints/kube-system/metrics-server</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-479"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/specs/default/kubernetes</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-480"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/specs/default/nginx</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-481"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/specs/default/ngnix-service</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-482"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/specs/default/test1</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-483"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/specs/kube-system/kube-dns</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-484"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/specs/kube-system/kubelet</span>
<a name="rest_code_6cb74830316f412aa8617289a29f16a3-485"></a><span class="l l-Scalar l-Scalar-Plain">/registry/services/specs/kube-system/metrics-server</span>
</pre>
<p>Now lets check all pods with all namespaces so something like  kubectl get pods --all-namespaces</p>
<pre class="code bash"><a name="rest_code_8057991a597b464581e7b08d11588774-1"></a>kubectl <span class="nb">exec</span> -it etcd-lenovo-node1 -n kube-system -- /bin/sh -c <span class="s2">"ETCDCTL_API=3 etcdctl \</span>
<a name="rest_code_8057991a597b464581e7b08d11588774-2"></a><span class="s2">--endpoints=https://127.0.0.1:2379 \</span>
<a name="rest_code_8057991a597b464581e7b08d11588774-3"></a><span class="s2">--cacert=/etc/kubernetes/pki/etcd/ca.crt \</span>
<a name="rest_code_8057991a597b464581e7b08d11588774-4"></a><span class="s2">--cert=/etc/kubernetes/pki/etcd/server.crt \</span>
<a name="rest_code_8057991a597b464581e7b08d11588774-5"></a><span class="s2">--key=/etc/kubernetes/pki/etcd/server.key \</span>
<a name="rest_code_8057991a597b464581e7b08d11588774-6"></a><span class="s2">get /registry/pods --prefix --keys-only</span>
</pre>
<p>Output:</p>
<pre class="code bash"><a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-1"></a>➜  etcd git:<span class="o">(</span>master<span class="o">)</span> ✗ kubectl get pods --all-namespaces
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-2"></a>NAMESPACE        NAME                                       READY   STATUS        RESTARTS   AGE
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-3"></a>default          ng                                         <span class="m">1</span>/1     Running       <span class="m">0</span>          11d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-4"></a>default          nginx-b4c9f744d-6fqjs                      <span class="m">1</span>/1     Running       <span class="m">0</span>          10d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-5"></a>default          nginx-b4c9f744d-hvdsh                      <span class="m">1</span>/1     Running       <span class="m">0</span>          10d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-6"></a>default          nginx-hpa-6c4758554f-99h7l                 <span class="m">1</span>/1     Terminating   <span class="m">0</span>          45d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-7"></a>default          nginx-hpa-6c4758554f-tqrp9                 <span class="m">1</span>/1     Terminating   <span class="m">0</span>          45d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-8"></a>default          nginx-hpa-6c4758554f-zf4rd                 <span class="m">1</span>/1     Terminating   <span class="m">0</span>          45d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-9"></a>kube-system      calico-kube-controllers-664b5654ff-lmfjw   <span class="m">1</span>/1     Running       <span class="m">0</span>          46d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-10"></a>kube-system      calico-node-6vtln                          <span class="m">1</span>/1     Running       <span class="m">0</span>          46d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-11"></a>kube-system      calico-node-9psrj                          <span class="m">1</span>/1     Running       <span class="m">0</span>          46d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-12"></a>kube-system      calico-node-n64kf                          <span class="m">1</span>/1     Running       <span class="m">0</span>          46d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-13"></a>kube-system      calico-node-s4gnp                          <span class="m">1</span>/1     Running       <span class="m">0</span>          46d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-14"></a>kube-system      coredns-74ff55c5b-n942q                    <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-15"></a>kube-system      coredns-74ff55c5b-vnm7t                    <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-16"></a>kube-system      etcd-lenovo-node1                          <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-17"></a>kube-system      kube-apiserver-lenovo-node1                <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-18"></a>kube-system      kube-controller-manager-lenovo-node1       <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-19"></a>kube-system      kube-proxy-dxtr2                           <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-20"></a>kube-system      kube-proxy-r7jpl                           <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-21"></a>kube-system      kube-proxy-sb4b6                           <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-22"></a>kube-system      kube-proxy-v9xck                           <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-23"></a>kube-system      kube-scheduler-lenovo-node1                <span class="m">1</span>/1     Running       <span class="m">0</span>          47d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-24"></a>kube-system      metrics-server-666b5bc478-8624s            <span class="m">1</span>/1     Running       <span class="m">0</span>          45d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-25"></a>metallb-system   controller-65db86ddc6-q6zvx                <span class="m">1</span>/1     Running       <span class="m">0</span>          33d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-26"></a>metallb-system   speaker-6mzwx                              <span class="m">1</span>/1     Running       <span class="m">0</span>          33d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-27"></a>metallb-system   speaker-btrtz                              <span class="m">1</span>/1     Running       <span class="m">0</span>          33d
<a name="rest_code_ff5a712305c84c83b84f2c91b06f1a95-28"></a>metallb-system   speaker-pxf28                              <span class="m">1</span>/1     Running       <span class="m">0</span>          33d
</pre>
<p>From the reference above - I can see pods are under /registry/pods and then the next key is namespace so to get pods in
kubesystem we need to use key /registry/pods/kube-system/</p>
<p>We might observe something interesting watching one of the pods:</p>
<pre class="code bash"><a name="rest_code_ca3dd3544bd646309eb94dd6ecd1b7f8-1"></a>kubectl <span class="nb">exec</span> -it etcd-lenovo-node1 -n kube-system -- /bin/sh -c <span class="s2">"ETCDCTL_API=3 etcdctl</span>
<a name="rest_code_ca3dd3544bd646309eb94dd6ecd1b7f8-2"></a><span class="s2">--endpoints=https://127.0.0.1:2379 \</span>
<a name="rest_code_ca3dd3544bd646309eb94dd6ecd1b7f8-3"></a><span class="s2">--cacert=/etc/kubernetes/pki/etcd/ca.crt \</span>
<a name="rest_code_ca3dd3544bd646309eb94dd6ecd1b7f8-4"></a><span class="s2">--cert=/etc/kubernetes/pki/etcd/server.crt \</span>
<a name="rest_code_ca3dd3544bd646309eb94dd6ecd1b7f8-5"></a><span class="s2">--key=/etc/kubernetes/pki/etcd/server.key \</span>
<a name="rest_code_ca3dd3544bd646309eb94dd6ecd1b7f8-6"></a><span class="s2">watch /registry/pods/default/nginx-b4c9f744d-6fqjs "</span>
</pre>
<p>and I will just add new label in another terminal</p>
<pre class="code bash"><a name="rest_code_128ffcf2ee554897a8e8e347228872b0-1"></a>kc label pods pod nginx-b4c9f744d-6fqjs my-new-label<span class="o">=</span><span class="nb">test</span>
</pre>
<p>we can see straight away the change in watch command :)</p>
</div>
<div class="section" id="accessing-etcd-from-host">
<h2>Accessing etcd from host</h2>
<p>If we want to access etcdctl locally (locally means - still need to be on one of the nodes) we just need to install etcd-client</p>
<p>on ubuntu</p>
<pre class="code bash"><a name="rest_code_38f23cf56cfd4eedb9698f0f49cba504-1"></a>sudo apt-get install etcd-client
</pre>
<p>and then we should be able to get all etcd instances with</p>
<pre class="code bash"><a name="rest_code_f3178d3076524ebda0de5ca1e191945c-1"></a>sudo <span class="nv">ETCDCTL_API</span><span class="o">=</span><span class="m">3</span> etcdctl --endpoints<span class="o">=</span>https://127.0.0.1:2379 --cacert<span class="o">=</span>/etc/kubernetes/pki/etcd/ca.crt --cert<span class="o">=</span>/etc/kubernetes/pki/etcd/server.crt --key<span class="o">=</span>/etc/kubernetes/pki/etcd/server.key   member list
</pre>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/build-cheapest-kubernetes-i7-cluster.html" class="u-url">Build cheapest kubernetes i7 cluster</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/build-cheapest-kubernetes-i7-cluster.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2021-01-18T23:58:56Z" title="2021-01-18 23:58">2021-01-18 23:58</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/build-cheapest-kubernetes-i7-cluster.html#disqus_thread" data-disqus-identifier="cache/posts/build-cheapest-kubernetes-i7-cluster.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div class="section" id="how-i-ve-build-4-nodes-kubernetes-i7-16gb-cluster">
<h2>How I've build 4 nodes kubernetes i7 16GB cluster</h2>
<p>I always wanted to build my own k8s cluster, but couldn't see any reliable "budget" 3-4 nodes option to go for - yes there are a
lot of attempts of building kubernetes which are:</p>
<ul class="simple">
<li><p>raspberry pi which are not  x86 compatible so you wont run a lot of docker images there</p></li>
<li><p>some tv hdmi sticks - better than raspberry but cpus are quite weak.</p></li>
</ul>
<p>So one day my laptops display has broken.</p>
<p>It was i7 with 16gb RAM it I have identified malfunction was was the port to lcd display on the motherboard as the hdmi output worked fine.</p>
<p>I have replaced the motherboard and doing so I had the old spare but kida headless without display well hdmi output still worked).</p>
<p>Also when buying replacement motherboard  I have discovered there are sold for 100 quid (coming from some after leasing refurbished laptops) so probably the cheapes k8s cluster we can have on i7's and 16GB RAM per node.</p>
<img alt="/images/IMG_20201024_184958.jpg" src="images/IMG_20201024_184958.jpg"><div class="section" id="the-parts">
<h3>The parts:</h3>
<p>Note: I've used 00JT811 because I had spare one you can use any i7/i5 laptops motherboard I have just found that
actually on ebay there are i5 00JT371 i5-5200U for 50quid !! and it's the same number of cores/threads just at the lower frequency 2.60 GHz vs 2.20GHz base freq.</p>
<p>3 x £120 Lenovo Yoga X1 Carbon 00JT811 Core i7-6600U 2.6GHz Laptop Motherboard [from ebay] || or 4x £50 i5 00JT371 i5-5200U</p>
<p>4 x £12.93 Sandisk 120GB SSD [from Amazon warehouse deals] - optional could do it network bootable!!!</p>
<p>4 x lenovo laptop chargin adapters (had old ones so didnt have top buy)</p>
<p>3 x 1GB Ethernet over oneLink+ interface (7each)</p>
<p>1 x 1GB Ethernet over OneLink+ dock station (I had old one)</p>
<p>1 x used battery for master node (to secure etcd even better from power failure) £10</p>
<p>1 x Server Case to pack it up 2U Short ATX Chassis - Low Profile PCI Card Support - 390mm Depth £47</p>
<p>Overall for mine with i7: £489</p>
<p>Alternative with i5: £329</p>
<p>I had old intell skull i7 as my previous lab server so I have sold it for £400 so in the end by just adding 89 quid and week of work during evenings I had 4 nodes powerfull kubernetes
cluster.</p>
</div>
<div class="section" id="problem-1-how-to-stack-it-on-each-other">
<h3>Problem 1 - How to stack it on each other?</h3>
<p>I had to find some way how to put the motherboards on each other safetly - fortunately I had ender3 3dprinter and bit of
knowledge of 3d prototyping in blender so I have just designed simple pins on which I sould stack the motherboards.</p>
<img alt="/images/IMG_20201013_144202.jpg" src="images/IMG_20201013_144202.jpg"><img alt="/images/IMG_20201016_172922.jpg" src="images/IMG_20201016_172922.jpg">
</div>
<div class="section" id="problem-2-powering-it-on">
<h3>Problem 2 - Powering it on</h3>
<p>Solution 1 - BIOS Restore on AC Power loss - just pluggin in to power adapter should power on my motherboards</p>
<p>Solution 2 - Add power button - unfortunatelly its almost impossibile to buy power button separately for this
motherboard they are available on aliexpress for 17 quid which is ridiculous.</p>
<p>I have found 1 button for 5 on ebay and have reverse engineered it.</p>
<p>So Laptop power on switch works bit different than I though its not working like in PC ATX switch just short circuiting
2 cables - I had to check with multimeter whats happening on which pins of the port of power switch.
It turned out its just adding 10Ohm resitance on button press.
I have just created my own buttons and added the resistors to each of them.</p>
<p>Mind the power adapters are outside of the whole server case and even server cabinet - they warm up and generate extra
heat so better to keep them out- the fans in cabinet will be more quiet then..</p>
<img alt="/images/IMG_20201114_160524.jpg" src="images/IMG_20201114_160524.jpg"><img alt="/images/IMG_20201107_23234122.jpg" src="images/IMG_20201107_23234122.jpg"><p>I forgot to make pic but I below the buttons there are 10 Ohm resistors soldered to one leg.</p>
<img alt="/images/IMG_20201030_21072011.jpg" src="images/IMG_20201030_21072011.jpg"><p>So it's pin 1 and 3 (on the ribbon positioned like below) which needs to be applied with 10Ohm resistor.</p>
<img alt="/images/pins.jpg" src="images/pins.jpg"><p>I had to do my own buttons too as case came with 2 buttons and 2 led diodes I just took off whole pcb and made my own
with just buttons and printed out the plastic long buttons.
Also added external usb3 extensions</p>
<img alt="/images/IMG_20201107_232356.jpg" src="images/IMG_20201107_232356.jpg">
</div>
<div class="section" id="problem-3-ethernet">
<h3>Problem 3 Ethernet</h3>
<p>I wanted it to look nice so I have designed some panel to put into server case and connect all the ethernet adapters +
docking station together.</p>
<img alt="/images/IMG_20201020_173526.jpg" src="images/IMG_20201020_173526.jpg"><img alt="/images/IMG_20201020_173919.jpg" src="images/IMG_20201020_173919.jpg"><img alt="/images/IMG_20201024_180934.jpg" src="images/IMG_20201024_180934.jpg"><img alt="/images/IMG_20201026_220703.jpg" src="images/IMG_20201026_220703.jpg">
</div>
<div class="section" id="connecting-it-all-together-inside-the-server-case">
<h3>Connecting it all together inside the server case</h3>
<p>Having all the parts printed and ready I've started assembling everything together which was the biggest fun.</p>
<img alt="/images/IMG_20201026_221755_1.jpg" src="images/IMG_20201026_221755_1.jpg"><img alt="/images/IMG_20201023_162733.jpg" src="images/IMG_20201023_162733.jpg"><img alt="/images/IMG_20201023_162735.jpg" src="images/IMG_20201023_162735.jpg"><img alt="/images/IMG_20201122_134807.jpg" src="images/IMG_20201122_134807.jpg"><div class="section" id="battery-for-master-node">
<h4>Battery for master node</h4>
<p>As seen below in the bottom - the motherboard is supplied with laptop battery - it's the master node with etcd running so it has
some extra power protection (I have 2 UPSes fot the whole cabinet though)</p>
<img alt="/images/IMG_20201114_160532.jpg" src="images/IMG_20201114_160532.jpg">
</div>
</div>
<div class="section" id="final-effects">
<h3>Final effects</h3>
<p>So in the end this little 2U box is i7 16GB x4NODES kubernetes cluster!!!</p>
<img alt="/images/IMG_20210121_234056.jpg" src="images/IMG_20210121_234056.jpg">
</div>
<div class="section" id="clarification">
<h3>Clarification</h3>
<p>Of course I forgot to mention (intentionally or not to lower overall costs :)  ) the extra 2U case didnt fit to my 9U
Cabinet anymore as there is Dream Machine Pro and some PoE Switch and a NAS there already so  I had to buy bigger server cabinet 15U</p>
<p>Because of that I had to hire some external contractor to assembe it so this costed me 2 extra hrs spent at playground + 2 kinder surprise eggs.</p>
<img alt="/images/IMG_20201121_113644.jpg" src="images/IMG_20201121_113644.jpg"><p>So inside case it looks like this</p>
<img alt="/images/IMG_20201205_185254.jpg" src="images/IMG_20201205_185254.jpg"><p>And everything connected together</p>
<img alt="/images/IMG-20210107-WA0012.jpeg" src="images/IMG-20210107-WA0012.jpeg"><img alt="/images/IMG-20201123-WA0000.jpeg" src="images/IMG-20201123-WA0000.jpeg">
</div>
<div class="section" id="future-plans">
<h3>Future plans</h3>
<p>For now I have half-automatically installed k8s on my Nodes from playbooks taken from my prev project (kubernetes
cluster on vagrant ) <a class="reference external" href="https://github.com/greg4fun/k8s_simulation_on_vagrant">https://github.com/greg4fun/k8s_simulation_on_vagrant</a> , but I have in plans to make it full IaC and use Hashis Terraform.</p>
<img alt="/images/cluster.png" src="images/cluster.png"><div class="section" id="master-temperature-with-lights">
<h4>Master temperature with lights</h4>
<p>As seen on photos below there are leds - this is Philips Hue strip I have allready played with python API and I'm going to
connect those leds to the Master node temperature readings.</p>
<img alt="/images/IMG_20201229_180451.jpg" src="images/IMG_20201229_180451.jpg"><img alt="/images/IMG-20210107-WA0010.jpeg" src="images/IMG-20210107-WA0010.jpeg">
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/mysql-on-kubernetes-with-persistent-volume-and-secrets.html" class="u-url">Mysql on kubernetes with persistent volume and secrets</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/mysql-on-kubernetes-with-persistent-volume-and-secrets.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2020-06-28T08:50:51Z" title="2020-06-28 08:50">2020-06-28 08:50</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/mysql-on-kubernetes-with-persistent-volume-and-secrets.html#disqus_thread" data-disqus-identifier="cache/posts/mysql-on-kubernetes-with-persistent-volume-and-secrets.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div class="section" id="volumes">
<h2>Volumes</h2>
<div class="section" id="persistent-storage-with-nfs">
<h3>Persistent storage with NFS</h3>
<p>In this example I have created nfs share "PersistentVolume" on my qnap NAS which IP is 192.168.1.11
Create persistentVolume.yml</p>
<pre class="code yaml"><a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-1"></a><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-2"></a><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-4"></a>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pv0001</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-5"></a><span class="nt">spec</span><span class="p">:</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-6"></a>  <span class="nt">capacity</span><span class="p">:</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-7"></a>    <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100Gi</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-8"></a>  <span class="nt">accessModes</span><span class="p">:</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-9"></a>  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-10"></a>  <span class="nt">mountOptions</span><span class="p">:</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-11"></a>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">nfsvers=4.1</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-12"></a>  <span class="nt">nfs</span><span class="p">:</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-13"></a>    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/PersistentVolume/pv0001</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-14"></a>    <span class="nt">server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.11</span>
<a name="rest_code_ea5d0b3e8e754a41b465ab6a9513ea63-15"></a>  <span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Retain</span>
</pre>
<p>Create persistentVolumeClaim.yml</p>
<pre class="code yaml"><a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-1"></a><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-2"></a><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-4"></a>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-pv-claim</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-5"></a><span class="nt">spec</span><span class="p">:</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-6"></a>  <span class="nt">accessModes</span><span class="p">:</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-7"></a>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-8"></a>  <span class="nt">resources</span><span class="p">:</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-9"></a>    <span class="nt">requests</span><span class="p">:</span>
<a name="rest_code_ec71b87ce81c4565a91c95c433c732dc-10"></a>      <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10Gi</span>
</pre>
</div>
<div class="section" id="secrets">
<h3>Secrets</h3>
<p>The configuration of your containers should be stored in separate place to guarantee mobility (it shouldnt be hardcoded ) neither should it be stored in database
The best approach is to store your configuration in environment variables for docker for instance you can store it in env files which are gitignored or env vars which you need to set during container startup.
In kubernetes you have option to store all configuration like usernames, passwords, API urls etc in configmaps and secrets.
Passwords shouldnt be stored in configmaps though as it is stored there in plain text.So the best choice for passwords is secrets which stores data in base64.</p>
<p>Create password and user and db name and encode it with base64</p>
<pre class="code bash"><a name="rest_code_f619ff63e90f4cc68420ae373dc3b84b-1"></a><span class="nb">echo</span> -n <span class="s2">"MyPassword"</span> <span class="p">|</span> base64 <span class="c1">#TXlQYXNzd29yZA==</span>
<a name="rest_code_f619ff63e90f4cc68420ae373dc3b84b-2"></a><span class="nb">echo</span> -n <span class="s2">"django"</span> <span class="p">|</span> base64  <span class="c1"># ZGphbmdv</span>
<a name="rest_code_f619ff63e90f4cc68420ae373dc3b84b-3"></a><span class="nb">echo</span> -n <span class="s2">"kubernetes_test"</span> <span class="p">|</span> base64 <span class="c1"># a3ViZXJuZXRlc190ZXN0</span>
</pre>
<p>Apply above results to secret.yml</p>
<pre class="code yaml"><a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-1"></a><span class="nn">---</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-2"></a><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-3"></a><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-5"></a>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-secrets</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-6"></a><span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-7"></a><span class="nt">data</span><span class="p">:</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-8"></a>  <span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TXlQYXNzd29yZA==</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-9"></a>  <span class="nt">MYSQL_USER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ZGphbmdv</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-10"></a>  <span class="nt">MYSQL_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ZGphbmdv</span>
<a name="rest_code_3b2ab965c47541a0a3c06af7bd9d88f3-11"></a>  <span class="nt">MYSQL_DATABASE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">a3ViZXJuZXRlc190ZXN0</span>
</pre>
<p>On your cluster create secrets.yml</p>
<pre class="code bash"><a name="rest_code_f6d81b22dbda47dfb68f434fec5ce8df-1"></a>kubectl create -f secrets.yml
</pre>
</div>
<div class="section" id="mysql-application">
<h3>Mysql application</h3>
<p>Now having persistent volumeclain and secrets we can write mysql deployment file</p>
<p>deployment.yml</p>
<pre class="code yaml"><a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-1"></a><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-2"></a><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-4"></a>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-deployment</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-5"></a>  <span class="nt">labels</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-6"></a>    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-7"></a><span class="nt">spec</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-8"></a>  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-9"></a>  <span class="nt">selector</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-10"></a>    <span class="nt">matchLabels</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-11"></a>      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-12"></a>  <span class="nt">template</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-13"></a>    <span class="nt">metadata</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-14"></a>      <span class="nt">labels</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-15"></a>        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-16"></a>    <span class="nt">spec</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-17"></a>      <span class="nt">containers</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-18"></a>        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-19"></a>          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql:5.7</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-20"></a>          <span class="nt">ports</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-21"></a>            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3306</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-22"></a>          <span class="nt">volumeMounts</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-23"></a>            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="s">"/var/lib/mysql"</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-24"></a>              <span class="nt">subPath</span><span class="p">:</span> <span class="s">"mysql"</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-25"></a>              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-data</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-26"></a>          <span class="nt">env</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-27"></a>            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-28"></a>              <span class="nt">valueFrom</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-29"></a>                <span class="nt">secretKeyRef</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-30"></a>                  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-secrets</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-31"></a>                  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-32"></a>            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_USER</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-33"></a>              <span class="nt">valueFrom</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-34"></a>                <span class="nt">secretKeyRef</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-35"></a>                  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-secrets</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-36"></a>                  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_USER</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-37"></a>            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-38"></a>              <span class="nt">valueFrom</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-39"></a>                <span class="nt">secretKeyRef</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-40"></a>                  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-secrets</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-41"></a>                  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-42"></a>            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-43"></a>              <span class="nt">valueFrom</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-44"></a>                <span class="nt">secretKeyRef</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-45"></a>                  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-secrets</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-46"></a>                  <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_DATABASE</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-47"></a>      <span class="nt">volumes</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-48"></a>        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-data</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-49"></a>          <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
<a name="rest_code_c8b0394c926e458f99b0f8c0d5f450eb-50"></a>            <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-pv-claim</span>
</pre>
<pre class="code bash"><a name="rest_code_78f3b4f6980f43d99f0ff562e98e2d0d-1"></a>kubectl apply -f deployment.yml
</pre>
</div>
<div class="section" id="checking">
<h3>Checking</h3>
<p>Now we can check if our deployment was successful:</p>
<pre class="code bash"><a name="rest_code_2f18f672e4024a2e8f4344ea12293d17-1"></a>kubectl get deployments
<a name="rest_code_2f18f672e4024a2e8f4344ea12293d17-2"></a>
<a name="rest_code_2f18f672e4024a2e8f4344ea12293d17-3"></a>NAME               READY   UP-TO-DATE   AVAILABLE   AGE
<a name="rest_code_2f18f672e4024a2e8f4344ea12293d17-4"></a>mysql-deployment   <span class="m">1</span>/1     <span class="m">1</span>            <span class="m">1</span>           66m
</pre>
<p>If somethings wrong you can always investigate with describe or logs</p>
<pre class="code bash"><a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-1"></a>kubectl describe deployment mysql-deployment
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-2"></a>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-3"></a>Name:                   mysql-deployment
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-4"></a>Namespace:              default
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-5"></a>CreationTimestamp:      Sun, <span class="m">28</span> Jun <span class="m">2020</span> <span class="m">17</span>:02:00 +0000
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-6"></a>Labels:                 <span class="nv">app</span><span class="o">=</span>mysql
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-7"></a>Annotations:            deployment.kubernetes.io/revision: <span class="m">1</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-8"></a>Selector:               <span class="nv">app</span><span class="o">=</span>mysql
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-9"></a>Replicas:               <span class="m">1</span> desired <span class="p">|</span> <span class="m">1</span> updated <span class="p">|</span> <span class="m">1</span> total <span class="p">|</span> <span class="m">1</span> available <span class="p">|</span> <span class="m">0</span> unavailable
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-10"></a>StrategyType:           RollingUpdate
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-11"></a>MinReadySeconds:        <span class="m">0</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-12"></a>RollingUpdateStrategy:  <span class="m">25</span>% max unavailable, <span class="m">25</span>% max surge
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-13"></a>Pod Template:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-14"></a>Labels:  <span class="nv">app</span><span class="o">=</span>mysql
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-15"></a>Containers:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-16"></a>mysql:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-17"></a>    Image:      mysql:5.7
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-18"></a>    Port:       <span class="m">3306</span>/TCP
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-19"></a>    Host Port:  <span class="m">0</span>/TCP
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-20"></a>    Environment:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-21"></a>    MYSQL_ROOT_PASSWORD:  &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_ROOT_PASSWORD'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;  Optional: <span class="nb">false</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-22"></a>    MYSQL_USER:           &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_USER'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;           Optional: <span class="nb">false</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-23"></a>    MYSQL_PASSWORD:       &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_PASSWORD'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;       Optional: <span class="nb">false</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-24"></a>    MYSQL_DATABASE:       &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_DATABASE'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;       Optional: <span class="nb">false</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-25"></a>    Mounts:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-26"></a>    /var/lib/mysql from mysql-data <span class="o">(</span>rw,path<span class="o">=</span><span class="s2">"mysql"</span><span class="o">)</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-27"></a>Volumes:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-28"></a>mysql-data:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-29"></a>    Type:       PersistentVolumeClaim <span class="o">(</span>a reference to a PersistentVolumeClaim in the same namespace<span class="o">)</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-30"></a>    ClaimName:  mysql-pv-claim
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-31"></a>    ReadOnly:   <span class="nb">false</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-32"></a>Conditions:
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-33"></a>Type           Status  Reason
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-34"></a>----           ------  ------
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-35"></a>Available      True    MinimumReplicasAvailable
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-36"></a>Progressing    True    NewReplicaSetAvailable
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-37"></a>OldReplicaSets:  &lt;none&gt;
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-38"></a>NewReplicaSet:   mysql-deployment-579b8bb767 <span class="o">(</span><span class="m">1</span>/1 replicas created<span class="o">)</span>
<a name="rest_code_5ef43da858a64d4ab8f6c8deb152ed6f-39"></a>Events:          &lt;none&gt;
</pre>
<p>Or investigate pods</p>
<pre class="code bash"><a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-1"></a>kubectl get pods
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-2"></a>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-3"></a>NAME                                READY   STATUS    RESTARTS   AGE
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-4"></a>mysql-deployment-579b8bb767-mk5jx   <span class="m">1</span>/1     Running   <span class="m">0</span>          69m
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-5"></a>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-6"></a>kubectl describe pod mysql-deployment-579b8bb767-mk5jx
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-7"></a>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-8"></a>Name:         mysql-deployment-579b8bb767-mk5jx
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-9"></a>Namespace:    default
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-10"></a>Priority:     <span class="m">0</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-11"></a>Node:         worker4/192.168.50.15
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-12"></a>Start Time:   Sun, <span class="m">28</span> Jun <span class="m">2020</span> <span class="m">17</span>:02:00 +0000
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-13"></a>Labels:       <span class="nv">app</span><span class="o">=</span>mysql
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-14"></a>            pod-template-hash<span class="o">=</span>579b8bb767
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-15"></a>Annotations:  cni.projectcalico.org/podIP: <span class="m">192</span>.168.199.131/32
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-16"></a>Status:       Running
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-17"></a>IP:           <span class="m">192</span>.168.199.131
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-18"></a>IPs:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-19"></a>IP:           <span class="m">192</span>.168.199.131
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-20"></a>Controlled By:  ReplicaSet/mysql-deployment-579b8bb767
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-21"></a>Containers:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-22"></a>mysql:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-23"></a>    Container ID:   docker://b755c731e9b72812040d62315a2499d05cdaa6b8425e6b357fa19f1e9d6aed2c
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-24"></a>    Image:          mysql:5.7
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-25"></a>    Image ID:       docker-pullable://mysql@sha256:32f9d9a069f7a735e28fd44ea944d53c61f990ba71460c5c183e610854ca4854
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-26"></a>    Port:           <span class="m">3306</span>/TCP
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-27"></a>    Host Port:      <span class="m">0</span>/TCP
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-28"></a>    State:          Running
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-29"></a>    Started:      Sun, <span class="m">28</span> Jun <span class="m">2020</span> <span class="m">17</span>:02:02 +0000
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-30"></a>    Ready:          True
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-31"></a>    Restart Count:  <span class="m">0</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-32"></a>    Environment:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-33"></a>    MYSQL_ROOT_PASSWORD:  &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_ROOT_PASSWORD'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;  Optional: <span class="nb">false</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-34"></a>    MYSQL_USER:           &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_USER'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;           Optional: <span class="nb">false</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-35"></a>    MYSQL_PASSWORD:       &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_PASSWORD'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;       Optional: <span class="nb">false</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-36"></a>    MYSQL_DATABASE:       &lt;<span class="nb">set</span> to the key <span class="s1">'MYSQL_DATABASE'</span> in secret <span class="s1">'mysql-secrets'</span>&gt;       Optional: <span class="nb">false</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-37"></a>    Mounts:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-38"></a>    /var/lib/mysql from mysql-data <span class="o">(</span>rw,path<span class="o">=</span><span class="s2">"mysql"</span><span class="o">)</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-39"></a>    /var/run/secrets/kubernetes.io/serviceaccount from default-token-4wtnw <span class="o">(</span>ro<span class="o">)</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-40"></a>Conditions:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-41"></a>Type              Status
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-42"></a>Initialized       True
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-43"></a>Ready             True
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-44"></a>ContainersReady   True
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-45"></a>PodScheduled      True
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-46"></a>Volumes:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-47"></a>mysql-data:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-48"></a>    Type:       PersistentVolumeClaim <span class="o">(</span>a reference to a PersistentVolumeClaim in the same namespace<span class="o">)</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-49"></a>    ClaimName:  mysql-pv-claim
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-50"></a>    ReadOnly:   <span class="nb">false</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-51"></a>default-token-4wtnw:
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-52"></a>    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-53"></a>    SecretName:  default-token-4wtnw
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-54"></a>    Optional:    <span class="nb">false</span>
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-55"></a>QoS Class:       BestEffort
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-56"></a>Node-Selectors:  &lt;none&gt;
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-57"></a>Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="k">for</span> 300s
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-58"></a>                node.kubernetes.io/unreachable:NoExecute <span class="k">for</span> 300s
<a name="rest_code_f3a46a4d7b9548aa84d8e197ec327503-59"></a>Events:          &lt;none&gt;
</pre>
<p>Or logs from pod</p>
<pre class="code bash"><a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-1"></a>kubectl logs mysql-deployment-579b8bb767-mk5jx
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-2"></a>
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-3"></a><span class="m">2020</span>-06-28T17:02:13.695295Z <span class="m">0</span> <span class="o">[</span>Note<span class="o">]</span> IPv6 is available.
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-4"></a><span class="m">2020</span>-06-28T17:02:13.695350Z <span class="m">0</span> <span class="o">[</span>Note<span class="o">]</span>   - <span class="s1">'::'</span> resolves to <span class="s1">'::'</span><span class="p">;</span>
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-5"></a><span class="m">2020</span>-06-28T17:02:13.695392Z <span class="m">0</span> <span class="o">[</span>Note<span class="o">]</span> Server socket created on IP: <span class="s1">'::'</span>.
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-6"></a><span class="m">2020</span>-06-28T17:02:13.695906Z <span class="m">0</span> <span class="o">[</span>Warning<span class="o">]</span> Insecure configuration <span class="k">for</span> --pid-file: Location <span class="s1">'/var/run/mysqld'</span> in the path is accessible to all OS users. Consider choosing a different directory.
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-7"></a><span class="m">2020</span>-06-28T17:02:13.703856Z <span class="m">0</span> <span class="o">[</span>Note<span class="o">]</span> InnoDB: Buffer pool<span class="o">(</span>s<span class="o">)</span> load completed at <span class="m">200628</span> <span class="m">17</span>:02:13
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-8"></a><span class="m">2020</span>-06-28T17:02:13.746239Z <span class="m">0</span> <span class="o">[</span>Note<span class="o">]</span> Event Scheduler: Loaded <span class="m">0</span> events
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-9"></a><span class="m">2020</span>-06-28T17:02:13.746461Z <span class="m">0</span> <span class="o">[</span>Note<span class="o">]</span> mysqld: ready <span class="k">for</span> connections.
<a name="rest_code_4e0b03b2496840fba7e548e4f43d027e-10"></a>Version: <span class="s1">'5.7.30'</span>  socket: <span class="s1">'/var/run/mysqld/mysqld.sock'</span>  port: <span class="m">3306</span>  MySQL Community Server <span class="o">(</span>GPL<span class="o">)</span>
</pre>
<p>Where we can see our mysql server is up and running</p>
<p>We can now test if our secrets were applied by running exact same exec syntax as in docker
NEVER PROVIDE PASSWORD IN COMMAND LINE THIS IS JUST FOR DEMONSTRATION PURPOSES if you do just -p you will be prompted
for password</p>
<pre class="code bash"><a name="rest_code_678b5853a30c40169b7bd1d0155a3120-1"></a>kubectl <span class="nb">exec</span> -it mysql-deployment-579b8bb767-mk5jx -- mysql -u root -pMyPassword
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-2"></a>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-3"></a>mysql&gt; show databases<span class="p">;</span>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-4"></a>+--------------------+
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-5"></a><span class="p">|</span> Database           <span class="p">|</span>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-6"></a>+--------------------+
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-7"></a><span class="p">|</span> information_schema <span class="p">|</span>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-8"></a><span class="p">|</span> kubernetes_test    <span class="p">|</span>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-9"></a><span class="p">|</span> mysql              <span class="p">|</span>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-10"></a><span class="p">|</span> performance_schema <span class="p">|</span>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-11"></a><span class="p">|</span> sys                <span class="p">|</span>
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-12"></a>+--------------------+
<a name="rest_code_678b5853a30c40169b7bd1d0155a3120-13"></a><span class="m">5</span> rows in <span class="nb">set</span> <span class="o">(</span><span class="m">0</span>.02 sec<span class="o">)</span>
</pre>
<p>We can see initial db kubernetes_test was created
also lets try to log in to it with user and pass set up</p>
<pre class="code bash"><a name="rest_code_c8834d340531423688ae9cffe3d9ed4d-1"></a>kubectl <span class="nb">exec</span> -it mysql-deployment-579b8bb767-mk5jx -- mysql -u django -pdjango kubernetes_test
<a name="rest_code_c8834d340531423688ae9cffe3d9ed4d-2"></a>
<a name="rest_code_c8834d340531423688ae9cffe3d9ed4d-3"></a>Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for</span> help. Type <span class="s1">'\c'</span> to clear the current input statement.
<a name="rest_code_c8834d340531423688ae9cffe3d9ed4d-4"></a>
<a name="rest_code_c8834d340531423688ae9cffe3d9ed4d-5"></a>mysql&gt;
</pre>
<p>Everything works as expected!!</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/kuberenetes-nfs-persistent-volume.html" class="u-url">Kuberenetes NFS persistent volume</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/kuberenetes-nfs-persistent-volume.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2020-06-18T18:30:13Z" title="2020-06-18 18:30">2020-06-18 18:30</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/kuberenetes-nfs-persistent-volume.html#disqus_thread" data-disqus-identifier="cache/posts/kuberenetes-nfs-persistent-volume.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>k8s_nfs_persistent_volume</p>
<h2>Create nfs persistent volume:</h2>
<h3>What you need</h3>
<ul>
<li>
<p>NFS Server I have used NFS already installed on my QNAP NAS (You need to enable NO_ROOT_SQUASH on permissions)</p>
</li>
<li>
<p>K8s cluster</p>
</li>
</ul>
<p>Now having your NFS share here 192.168.1.11/Persistentvolume/
you can try if it works with mount </p>
<pre class="code literal-block"><span></span><code><span class="err">sudo mount -t nfs 192.168.1.11:/PersistentVolume /mnt/PersistentVolume</span>
</code></pre>


<p>Later on you can secure access with password.</p>
<p>If everything works fine we need persistent volume on our cluster</p>
<p>persistentvolume.yml</p>
<pre class="code literal-block"><span></span><code><span class="n">apiVersion</span><span class="o">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span> <span class="n">PersistentVolume</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="n">name</span><span class="o">:</span> <span class="n">pv0001</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">capacity</span><span class="o">:</span>
    <span class="n">storage</span><span class="o">:</span> <span class="mi">100</span><span class="n">Gi</span>
  <span class="n">accessModes</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">ReadWriteMany</span>
  <span class="n">mountOptions</span><span class="o">:</span>
    <span class="o">-</span> <span class="n">nfsvers</span><span class="o">=</span><span class="mf">4.1</span>
  <span class="n">nfs</span><span class="o">:</span>
    <span class="n">path</span><span class="o">:</span> <span class="sr">/PersistentVolume/</span><span class="n">pv0001</span>
    <span class="n">server</span><span class="o">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.11</span>
  <span class="n">persistentVolumeReclaimPolicy</span><span class="o">:</span> <span class="n">Retain</span>
</code></pre>


<p>Apply above yaml to the cluster</p>
<pre class="code literal-block"><span></span><code><span class="err">kubectl apply -f persistentvolume.yml</span>
</code></pre>


<p>Now we need to declare persistent volume claim </p>
<p>persistentvolumeclaim.yml</p>
<pre class="code literal-block"><span></span><code><span class="n">apiVersion</span><span class="o">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span> <span class="n">PersistentVolumeClaim</span>
<span class="n">metadata</span><span class="o">:</span>
  <span class="n">name</span><span class="o">:</span> <span class="n">mysql</span><span class="o">-</span><span class="n">pv</span><span class="o">-</span><span class="n">claim</span>
<span class="n">spec</span><span class="o">:</span>
  <span class="n">accessModes</span><span class="o">:</span>
    <span class="o">-</span> <span class="n">ReadWriteMany</span> 
  <span class="n">resources</span><span class="o">:</span>
    <span class="n">requests</span><span class="o">:</span>
      <span class="n">storage</span><span class="o">:</span> <span class="mi">10</span><span class="n">Gi</span>
</code></pre>


<p>Apply</p>
<pre class="code literal-block"><span></span><code><span class="err">kubectl apply -f persistentvolumeclaim.yml</span>
</code></pre>


<p>Check if it has been bound:</p>
<pre class="code literal-block"><span></span><code><span class="n">kubectl</span> <span class="k">get</span> <span class="n">pv</span>

<span class="n">NAME</span>     <span class="n">CAPACITY</span>   <span class="k">ACCESS</span> <span class="n">MODES</span>   <span class="n">RECLAIM</span> <span class="n">POLICY</span>   <span class="n">STATUS</span>   <span class="n">CLAIM</span>                    <span class="n">STORAGECLASS</span>   <span class="n">REASON</span>   <span class="n">AGE</span>
<span class="n">pv0001</span>   <span class="mi">100</span><span class="n">Gi</span>      <span class="n">RWX</span>            <span class="n">Retain</span>           <span class="n">Bound</span>    <span class="k">default</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span><span class="o">-</span><span class="n">claim</span>                           <span class="mi">2</span><span class="n">d4h</span>

<span class="n">kubectl</span> <span class="k">get</span> <span class="n">pvc</span> 
<span class="n">NAME</span>              <span class="n">STATUS</span>    <span class="n">VOLUME</span>   <span class="n">CAPACITY</span>   <span class="k">ACCESS</span> <span class="n">MODES</span>   <span class="n">STORAGECLASS</span>   <span class="n">AGE</span>
<span class="n">mysql</span><span class="o">-</span><span class="n">pv</span><span class="o">-</span><span class="n">claim</span>    <span class="n">Bound</span>     <span class="n">pv0001</span>   <span class="mi">100</span><span class="n">Gi</span>      <span class="n">RWX</span>                           <span class="mi">2</span><span class="n">d4h</span>
</code></pre>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/build-fully-working-zabbix-server-with-database-in-seconds-thanks-to-docker.html" class="u-url">Build fully working zabbix server with database in seconds thanks to docker</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/build-fully-working-zabbix-server-with-database-in-seconds-thanks-to-docker.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2018-03-16T17:47:56Z" title="2018-03-16 17:47">2018-03-16 17:47</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/build-fully-working-zabbix-server-with-database-in-seconds-thanks-to-docker.html#disqus_thread" data-disqus-identifier="cache/posts/build-fully-working-zabbix-server-with-database-in-seconds-thanks-to-docker.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>To install zabbix server quickly zabbix comes with help as they have prebuild their product with docker images.
There is lots of official zabbix images on dockerhub so it can just overwhelm you.
There are mixes of all different possibilities like zabbix with mysql or postgres or either sqlite,
zabbix served bt nginx or apache or java gateway.
Depending on stack which is closest to you you can easily build docker-compose that will just run selected stack in
seconds.
My pick was nginx mysql so to set up fully running zabbix server we need 3 images</p>
<ul class="simple">
<li><p>mysql-server</p></li>
<li><p>zabbix-web  - web interface</p></li>
<li><p>zabbix-server - main zabbix process responsible for polling and trapping data and sending notifications to users.</p></li>
</ul>
<p>In addition you can add postfix mail server for notifying users but its not
a must as you can use your own mail server if so - just remove postfix service from example below.</p>
<p>Notice(you may want to use some specific versions or alpine versions for production env)</p>
<p>Create some directory (directory name is crucial here for visibility and future maitenance
of your containers and volumes or networks as the name will be used as prefix
for docker containers created by docker-compose and also volumes directories
so it will be easier to identify in future which volume belongs to which stack
In Ubuntu volumes are usually being kept in/var/lib/docker/volumes but you can mount any directory from host by
just specifying absolute or relative path in service configuration so for instance for mysql in
example to mount mysql_data_dir just outside of our containers folder</p>
<pre class="code bash"><a name="rest_code_ada2736a3948419e8f78eed3f3f5c008-1"></a>volumes:
<a name="rest_code_ada2736a3948419e8f78eed3f3f5c008-2"></a>  - <span class="s1">'../mysql_data_dir:/var/lib/mysql'</span>
</pre>
<p>Now within directory create docker-compose.yml with selected technologies in my case it is:
#docker-compose.yml</p>
<pre class="code bash"><a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-1"></a>version: <span class="s1">'3'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-2"></a>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-3"></a>services:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-4"></a>  db:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-5"></a>    image: mysql:latest
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-6"></a>    restart: always
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-7"></a>    expose:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-8"></a>      - <span class="s1">'3336'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-9"></a>    environment:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-10"></a>      MYSQL_ROOT_PASSWORD: <span class="s1">'my_secret_password'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-11"></a>      MYSQL_USER: <span class="s1">'zabbixuser'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-12"></a>      MYSQL_PASSWORD: <span class="s1">'zabbix_password'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-13"></a>      MYSQL_ROOT_HOST: <span class="s1">'%'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-14"></a>    volumes:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-15"></a>      - <span class="s1">'mysql_data_dir:/var/lib/mysql'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-16"></a>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-17"></a>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-18"></a>  zabbix-server:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-19"></a>    image: zabbix/zabbix-server-mysql
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-20"></a>    links:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-21"></a>      - <span class="s2">"db:mysql"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-22"></a>      - <span class="s2">"postfix:postfix"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-23"></a>    environment:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-24"></a>      MYSQL_ROOT_PASSWORD: <span class="s1">'my_secret_password'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-25"></a>      MYSQL_USER: <span class="s1">'zabbixuser'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-26"></a>      MYSQL_PASSWORD: <span class="s1">'zabbixpassassword'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-27"></a>      DB_SERVER_HOST: <span class="s1">'mysql'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-28"></a>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-29"></a>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-30"></a>  zabbix-web:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-31"></a>    image: zabbix/zabbix-web-nginx-mysql
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-32"></a>    ports:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-33"></a>      - <span class="s1">'7777:80'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-34"></a>    links:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-35"></a>      - <span class="s2">"db:mysql"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-36"></a>      - <span class="s2">"zabbix-server:zabbix-server"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-37"></a>      - <span class="s2">"postfix:postfix"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-38"></a>    environment:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-39"></a>      MYSQL_ROOT_PASSWORD: <span class="s1">'my_secret_password'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-40"></a>      MYSQL_USER: <span class="s1">'zabbixuser'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-41"></a>      MYSQL_PASSWORD: <span class="s1">'zabbixpassassword'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-42"></a>      DB_SERVER_HOST: <span class="s1">'mysql'</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-43"></a>      ZBX_SERVER_HOST: <span class="s2">"zabbix-server"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-44"></a>      PHP_TZ: <span class="s2">"Europe/London"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-45"></a>  postfix:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-46"></a>    image: catatnight/postfix
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-47"></a>    hostname: support
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-48"></a>    environment:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-49"></a>      - <span class="nv">maildomain</span><span class="o">=</span>mydomain.com
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-50"></a>      - <span class="nv">smtp_user</span><span class="o">=</span>admin:my_password
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-51"></a>    ports:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-52"></a>      - <span class="s2">"25:25"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-53"></a>    expose:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-54"></a>      - <span class="s2">"25"</span>
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-55"></a>    volumes:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-56"></a>      - /etc/nginx/ssl/postfix:/etc/postfix/certs
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-57"></a>      - /etc/nginx/ssl/postfix:/etc/opendkim/domainkeys
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-58"></a>volumes:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-59"></a>  mysql_data_dir:
<a name="rest_code_5f18ca7caa1b4d98a74c79d567bae088-60"></a>    driver: <span class="nb">local</span>
</pre>
<p>The above solution is just enough to start zabbix server up and running in couple seconds.
To do it just run:
.. code-block:: bash</p>
<blockquote>
<p>sudo docker-compose up</p>
</blockquote>
<p>Thats it!!!
You now have your zabbix running on port 7777</p>
<p>So what happened here docker-compose up has build and runned 3 containers
by running zabbix container it discovered there are no tables in mysql and has built them.</p>
<p>Now you just need to add agents/servers you want to monitor.
Check out adding agent in separate post</p>
<p>Versions:
(versions I've used in this example Feb 2018):</p>
<p>Docker-compose: 1.17.0, build ac53b73
Docker: 17.09.1-ce, build 19e2cf6
Kernel: 4.13.0-36-generic
System: Ubuntu 16.04.3 LTS</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/adding-zabbix-agent-to-server.html" class="u-url">Adding zabbix agent to server</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/adding-zabbix-agent-to-server.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2018-03-16T09:27:50Z" title="2018-03-16 09:27">2018-03-16 09:27</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/adding-zabbix-agent-to-server.html#disqus_thread" data-disqus-identifier="cache/posts/adding-zabbix-agent-to-server.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Zabbix is very powerfull tool which its using agents (or SNMP) to monitor server resources.
Adding agent is easy but I had couple problems doing that when I used agent straight from my
ubuntus (16.04.3) repo as there was no encryption functionality in this agent well I guess so as
agent didn't recognize tls psk configuration so not very nice as by installing agent straight form repo
with "sudo apt-get update &amp;&amp; sudo apt-get install zabbix-agent" I had limited functionality and unencrypted server-agent traffic.
So there are 2 options we can install zabbix agent or use zabbix agent docker container.
Adding zabbix agent to host system.
For current day 3.2 is the latest so please change latest accordingly of how this artcile is old.
wget <a class="reference external" href="http://repo.zabbix.com/zabbix/3.2/ubuntu/pool/main/z/zabbix-release/zabbix-release_3.2-1+xenial_all.deb">http://repo.zabbix.com/zabbix/3.2/ubuntu/pool/main/z/zabbix-release/zabbix-release_3.2-1+xenial_all.deb</a>
sudo dpkg -i zabbix-release_3.2-1+xenial_all.deb
sudo apt-get update
apt-get purge zabbix-agent #remove previous if installed
apt-get install zabbix-agent</p>
<p>Now there are 3 basic options that need to be changed in agent config file:
/etc/zabbix/zabbix_agentd.conf</p>
<p>Server=ip of zabbix server
ServerActive=ip of zabbix server
Hostname=My host name</p>
<p>sudo service zabbix-agent restart</p>
<div class="section" id="add-host-to-server-through-web-interface">
<h2>Add host to server through web interface:</h2>
<p>In server go to Configuration-&gt; Hosts -&gt; Create host
type in host name
visible name
public IP address opf your agent.Select group and add agent.
Next is to select templates so add services you need to monitor (here linux + mysql : Template DB MySQL, Template OS Linux)
after saving you should see green ZBX available label on Hosts screen
Notice : I couldnt see zbx agent green icon until I added linux template / or zabbix agent template.</p>
</div>
<div class="section" id="seurity-setting-up-psk-encryption">
<h2>Seurity - Setting up PSK encryption:</h2>
<p>sh -c "openssl rand -hex 32 &gt; /etc/zabbix/zabbix_agentd.psk"
Now add below lines to /etc/zabbix/zabbix_agentd.conf
TLSConnect=psk
TLSAccept=psk
#each identity id must be different for each serverr connected to one zabbix server
TLSPSKIdentity=PSK SOMETHING
TLSPSKFile=/etc/zabbix/zabbix_agentd.psk
sudo service zabbix-agent restart
Get generated key string:
cat /etc/zabbix/zabbix_agentd.psk
and add encryption in zabbix server web interface :
In server go to Configuration-&gt; Hosts -&gt; my host-&gt;encryption</p>
<p>Select:
Connections to host PSK
connections from host PSK
PSK identity: PSK SOMETHING (same as in zabbixagent config file)
PSK: the hash generated (content of /etc/zabbix/zabbix_agentd.psk file on agent )
now there should be greebn psk lablel and all our traffice will be encrypted</p>
</div>
<div class="section" id="adding-mysql-monitoring-option">
<h2>Adding mysql monitoring option:</h2>
<p>add user credentials for mysqlclient on agent server:
mysql &gt; grant all privileges on <em>.</em> to zabbix@'%' identified by 'zabbixuserpassword';
use localhost or host you will be accessing mysql from % is just for test purpose to eliminate
authentication problems.</p>
<blockquote>
<p>Out of the topic - something about mysql remote connections and security:
My best practice is not to have any remote access like @'%' to mysql on any server I manage
its just dangerous and anyone can try bruteforcing and try to connect to our mysql server.
Another way I saw in many places if admin creates @'%' accesses they use it without any encryption so there is
plain text traffic comming from mysql-server/postgres straight to users computer which is not good (MITM etc).
The best would be to have your mysql server set up with ssl certificate but its not popular practice as may be
time consuming for setting up and for connecting to such server (preatty easu in mysql-workbench).
Faster way to encrypt your mysql confidential data traffic is to use ssh tunnel but there is
a limitation here user that needs access to mysql data needs to have ssh access to the server
if this is an option just define users with localhost as source like <a class="reference external" href="mailto:my_db_user@localhost">my_db_user@localhost</a>
this is safer as you cant guarantee mysql users competence so best practice is to prevent having '%',
to double secure this method do not to expose 3306 to the public and only allow localhost(unix socket) and 127.0.0.1
(remember mysqlclient unixsocket/ ip connection) to be able to connect through this port.
In dockerized mysql instances when I need it to be visible I just do ports config like
127.0.0.0:3306:3306 then it will be visible to host machine only.
but if user wont have ssh access to the server then only option you have is using ssl cert.
So remember having user@'%' or even <a class="reference external" href="mailto:user@'some_ip">user@'some_ip</a>' you still without ssl or ssh the traffic from mysql-server
is still unencrypted.</p>
</blockquote>
<p>Ok comming back to mysql monitoring config:
add client to my.cnf in /etc/mysql or to /etc/mysql/conf.d/mysql.cnf</p>
<p>[client]
user = zabbix
password = zabbixuserpassword
port = 3326
host = 127.0.0.1</p>
<p>add myu.cnf</p>
<p>mkdir -p /var/lib/zabbix/
cd /var/lib/zabbix
ln -sv /etc/mysql/my.cnf</p>
<p>service zabbix-agent restart</p>
<p>Now you can add mysql template items in zabbix server .</p>
<p>select linux templates to see agent visibility</p>
<p>bug in default userparameter_mysql agent file</p>
<p>cat /etc/zabbix/zabbix_agentd.d/userparameter_mysql.conf
redirect error to stdout to grep later</p>
<p>UserParameter=mysql.ping,HOME=/var/lib/zabbix mysqladmin ping 2&gt;&amp;1 | grep -c alive
previously was
UserParameter=mysql.ping,HOME=/var/lib/zabbix mysqladmin ping | grep -c alive
so grep didnt work</p>
<p>Write your post here.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/zabbix-stack-with-docker-composeyml.html" class="u-url">Zabbix stack with docker-compose.yml</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/zabbix-stack-with-docker-composeyml.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2018-03-15T17:14:48Z" title="2018-03-15 17:14">2018-03-15 17:14</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/zabbix-stack-with-docker-composeyml.html#disqus_thread" data-disqus-identifier="cache/posts/zabbix-stack-with-docker-composeyml.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div class="section" id="fully-working-zabbix-server-solution-with-ui-and-database-in-seconds">
<h2>Fully working zabbix server solution with UI and database in seconds</h2>
<p>I wanted to install zabbix server quickly with docker but amount of zabbix images (created by zabbix) on dockerhub just overwhelmed me.
To set up running zabbix server we need 3 images
* choice of sql DB
* zabbix-web  - web interface
* zabbix-server - main zabbix process responsible for polling and trapping data and sending notifications to users.</p>
<p>My choice of database was MySQL so I created docker-compose file to have full stack of running zabbix server:</p>
<p>Notice(you may want to use alpine versions for production env)
docker-compose.yml:</p>
<pre class="code bash"><a name="rest_code_ae94a7895adb44748fbff001edaaaf17-1"></a>version: <span class="s1">'3'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-2"></a>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-3"></a>services:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-4"></a>  db:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-5"></a>    image: mysql:latest
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-6"></a>    restart: always
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-7"></a>    expose:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-8"></a>      - <span class="s1">'3336'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-9"></a>    environment:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-10"></a>      MYSQL_ROOT_PASSWORD: <span class="s1">'my_secret_password'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-11"></a>      MYSQL_USER: <span class="s1">'zabbixuser'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-12"></a>      MYSQL_PASSWORD: <span class="s1">'zabbixpass'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-13"></a>      MYSQL_ROOT_HOST: <span class="s1">'%'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-14"></a>    volumes:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-15"></a>      - <span class="s1">'mysql_data_dir:/var/lib/mysql'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-16"></a>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-17"></a>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-18"></a>  zabbix-server:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-19"></a>    image: zabbix/zabbix-server-mysql
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-20"></a>    links:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-21"></a>      - <span class="s2">"db:mysql"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-22"></a>      - <span class="s2">"postfix:postfix"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-23"></a>    environment:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-24"></a>      MYSQL_ROOT_PASSWORD: <span class="s1">'my_secret_password'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-25"></a>      MYSQL_USER: <span class="s1">'zabbixuser'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-26"></a>      MYSQL_PASSWORD: <span class="s1">'zabbixpass'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-27"></a>      DB_SERVER_HOST: <span class="s1">'mysql'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-28"></a>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-29"></a>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-30"></a>  zabbix-web:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-31"></a>    image: zabbix/zabbix-web-nginx-mysql
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-32"></a>    ports:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-33"></a>      - <span class="s1">'7777:80'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-34"></a>    links:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-35"></a>      - <span class="s2">"db:mysql"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-36"></a>      - <span class="s2">"zabbix-server:zabbix-server"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-37"></a>      - <span class="s2">"postfix:postfix"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-38"></a>    environment:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-39"></a>      MYSQL_ROOT_PASSWORD: <span class="s1">'secret'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-40"></a>      MYSQL_USER: <span class="s1">'zabbixuser'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-41"></a>      MYSQL_PASSWORD: <span class="s1">'myzabbixpass'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-42"></a>      DB_SERVER_HOST: <span class="s1">'mysql'</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-43"></a>      ZBX_SERVER_HOST: <span class="s2">"zabbix-server"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-44"></a>      PHP_TZ: <span class="s2">"Europe/London"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-45"></a>  postfix:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-46"></a>    image: catatnight/postfix
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-47"></a>    hostname: support
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-48"></a>    environment:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-49"></a>      - <span class="nv">maildomain</span><span class="o">=</span>domain.com
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-50"></a>      - <span class="nv">smtp_user</span><span class="o">=</span>admin:password
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-51"></a>    ports:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-52"></a>      - <span class="s2">"25:25"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-53"></a>    <span class="c1">#  - "465:465"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-54"></a>    <span class="c1">#  - "587:587"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-55"></a>    expose:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-56"></a>      - <span class="s2">"25"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-57"></a>    <span class="c1">#  - "465"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-58"></a>    <span class="c1">#  - "587"</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-59"></a>    volumes:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-60"></a>      - /etc/nginx/ssl/postfix:/etc/postfix/certs
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-61"></a>      - /etc/nginx/ssl/postfix:/etc/opendkim/domainkeys
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-62"></a>volumes:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-63"></a>  mysql_data_dir:
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-64"></a>    driver: <span class="nb">local</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-65"></a>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-66"></a>      <span class="c1">#- ./deployment/config_files/main-postfix-live.cf:/etc/postfix/main.cf</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-67"></a>    <span class="c1">#networks:</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-68"></a>    <span class="c1">#  - backend</span>
<a name="rest_code_ae94a7895adb44748fbff001edaaaf17-69"></a>    <span class="c1">#entrypoint: /docker-entrypoint.sh</span>
</pre>
<p>The above solution is just enough to start zabbix server up and
running in couple seconds. To run it just put yml file into some directory (directory is important as volume created for mysql will have this dir name as prefix) volumes are usually stored in /var/lib/docker/volumes and run:</p>
<pre class="code bash"><a name="rest_code_c1d62686342e4600906a92bd69f87161-1"></a>sudo docker-compose up
</pre>
<p>Thats it!!!
You now have your zabbix running on port 7777</p>
<p>So what happened here docker-compose up has build and runned 3 containers
by running zabbix container it discovered there are no tables in mysql and has built them.</p>
<p>Now you just need to add agents/servers you want to monitor.
Check out adding agent in separate post [here]</p>
<p>Versions:
(versions I've used in this example Feb 2018):</p>
<p>Docker-compose: 1.17.0, build ac53b73
Docker: 17.09.1-ce, build 19e2cf6
Kernel: 4.13.0-36-generic</p>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/git-commants-ive-found-useful.html" class="u-url">GIT commants I've found useful</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/git-commants-ive-found-useful.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2016-11-03T10:46:51Z" title="2016-11-03 10:46">2016-11-03 10:46</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/git-commants-ive-found-useful.html#disqus_thread" data-disqus-identifier="cache/posts/git-commants-ive-found-useful.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Check files changed between branches</p>
<pre class="code bash"><a name="rest_code_d40cf9ba000e49ad9fa942308d70e80b-1"></a>git diff --name-status master..devel
</pre>
<p>Check changes on file form different branch/commit</p>
<pre class="code bash"><a name="rest_code_69cf40be8c5e4adaa0be87845d29e8e1-1"></a>git diff commit_hash -- filename
</pre>
<p>Same as above between 2 branches/commits</p>
<pre class="code bash"><a name="rest_code_566fb3ffe18446fbb9b340337d0ca359-1"></a>git diff commit_hash master -- filename
</pre>
<p>Check full file history</p>
<pre class="code bash"><a name="rest_code_1b6608d8bcc34ce5928c385d19b468ff-1"></a>git log -p -- filename
</pre>
<p>Check who broke production server :</p>
<pre class="code bash"><a name="rest_code_71be663ab2cc45889015531384d6f8c7-1"></a>git blame filename
</pre>
<p>Merge as one commit (need to commit afterwards) its not default like in normal merge:</p>
<pre class="code bash"><a name="rest_code_dcf31ae6635242ceba27c2cf5c2ee355-1"></a>git merge --squash branch
</pre>
<p>List of commits in git local storage</p>
<pre class="code bash"><a name="rest_code_50641311c5624d75a36806c4a3a907c7-1"></a>git reflog
</pre>
<p>Take(checkout) file from different branch/commit</p>
<pre class="code bash"><a name="rest_code_bec2d9bbf3cc49fbbe8fce6d7e14001e-1"></a>git checkout develop -- filename
<a name="rest_code_bec2d9bbf3cc49fbbe8fce6d7e14001e-2"></a>git checkout commit_hash -- filename
</pre>
<p>Reset current branch to remote:</p>
<pre class="code bash"><a name="rest_code_25ba452d12324e5cb787ae77a048079d-1"></a>git reset --hard origin/current_branch
<a name="rest_code_25ba452d12324e5cb787ae77a048079d-2"></a>git reset --hard origin/master
</pre>
<p>Save and depracate changes which were not commited</p>
<pre class="code bash"><a name="rest_code_1dfa2b6cb17646af976e567e31506a3d-1"></a>git stash
<a name="rest_code_1dfa2b6cb17646af976e567e31506a3d-2"></a>git stash save -a
</pre>
<p>Restore stash (by picking selected)</p>
<pre class="code bash"><a name="rest_code_51948ab4ef854e44a21e1a7bab2e0c0e-1"></a>git stash list
<a name="rest_code_51948ab4ef854e44a21e1a7bab2e0c0e-2"></a>git stash pop <span class="o">{</span><span class="m">0</span><span class="o">}</span>
</pre>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/fabric-auto-deployment-script.html" class="u-url">fabric - auto deployment script</a></h1>
        <div class="metadata">
            <p class="dateline"><a href="posts/fabric-auto-deployment-script.html" rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2016-11-02T14:45:29Z" title="2016-11-02 14:45">2016-11-02 14:45</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                Greg Stencel
            </span></p>
                <p class="commentline"><i class="fa fa-comment"></i> 
        
    <a href="posts/fabric-auto-deployment-script.html#disqus_thread" data-disqus-identifier="cache/posts/fabric-auto-deployment-script.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Recently I wrote fabric deployment scrip maybe someone will find it usefull.</p>
<p>It enables possibility to run "group execute" task with</p>
<pre class="code python"><a name="rest_code_5b6b57fde6f7405891fffa9e092f972b-1"></a><span class="n">fab</span> <span class="n">live_servers</span> <span class="n">pull</span> <span class="n">restart</span>
</pre>
<p>or single host</p>
<pre class="code python"><a name="rest_code_953bebeef44b43dfb069346d0a8f9f68-1"></a><span class="n">fab</span> <span class="n">live1</span> <span class="n">pull</span>
</pre>
<p>All we need to do is to define group or sinle host as function afterwards I used end update decorator.</p>
<p>I know there could be also something like duplication of tasks with separate servers fab live1 pull live2
pull but I believe that fabric was written for distributed systems which has different paths of apps and users
etc.</p>
<p>also roledefs with extra dict keys didn't work for me)? I want to keep this simple single/multiple host
deployment commands like : fab live_servers pull, fab test pull</p>
<pre class="code python"><a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-1"></a><span class="kn">from</span> <span class="nn">fabric.api</span> <span class="kn">import</span> <span class="n">run</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">local</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">cd</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-2"></a><span class="kn">from</span> <span class="nn">fabric.tasks</span> <span class="kn">import</span> <span class="n">execute</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-3"></a><span class="kn">import</span> <span class="nn">inspect</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-4"></a><span class="kn">import</span> <span class="nn">sys</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-5"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-6"></a><span class="kn">import</span> <span class="nn">re</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-7"></a><span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-8"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-9"></a><span class="c1"># fabfile author: Grzegorz Stencel</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-10"></a><span class="c1"># usage:</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-11"></a><span class="c1"># run: fab help for examples</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-12"></a><span class="c1"># fab staging svnxapp:app=holdings_and_quotes,layout.py,permissions.py restart</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-13"></a><span class="c1"># fab test svnxlib</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-14"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-15"></a><span class="n">SERVER_BRANCHES</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-16"></a>    <span class="s1">'live'</span><span class="p">:</span> <span class="s1">'master'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-17"></a>    <span class="s1">'sit'</span><span class="p">:</span> <span class="s1">'sit'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-18"></a>    <span class="s1">'uat'</span><span class="p">:</span> <span class="s1">'uat'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-19"></a>    <span class="s1">'live2'</span><span class="p">:</span><span class="s1">'master'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-20"></a>    <span class="s1">'live3'</span><span class="p">:</span><span class="s1">'master'</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-21"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-22"></a><span class="p">}</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-23"></a><span class="c1"># MAIN CONF</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-24"></a><span class="n">SERVERS</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-25"></a>    <span class="s1">'local'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-26"></a>        <span class="s1">'envname'</span><span class="p">:</span> <span class="s1">'local'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-27"></a>        <span class="s1">'user'</span><span class="p">:</span> <span class="s1">'greg'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-28"></a>        <span class="s1">'host'</span><span class="p">:</span> <span class="s1">'localhost'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-29"></a>        <span class="s1">'host_string'</span><span class="p">:</span> <span class="s1">'localhost'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-30"></a>        <span class="s1">'path'</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'SITE_ROOT'</span><span class="p">,</span> <span class="s1">'/opt/myapp/test'</span><span class="p">),</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-31"></a>        <span class="s1">'www_root'</span><span class="p">:</span> <span class="s1">'http://localhost:8081/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-32"></a>        <span class="s1">'retries_before_killing'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-33"></a>        <span class="s1">'retry_sleep'</span><span class="p">:</span> <span class="mi">2</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-34"></a>    <span class="p">},</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-35"></a>    <span class="s1">'test'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-36"></a>        <span class="s1">'envname'</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-37"></a>        <span class="s1">'user'</span><span class="p">:</span> <span class="s1">'root'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-38"></a>        <span class="s1">'host'</span><span class="p">:</span> <span class="s1">'myapp-test.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-39"></a>        <span class="s1">'host_string'</span><span class="p">:</span> <span class="s1">'myapp-test.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-40"></a>        <span class="s1">'path'</span><span class="p">:</span> <span class="s1">'/var/www/myapp/test/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-41"></a>        <span class="s1">'www_root'</span><span class="p">:</span> <span class="s1">'http://myapp-test.stencel.com/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-42"></a>        <span class="s1">'retries_before_killing'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-43"></a>        <span class="s1">'retry_sleep'</span><span class="p">:</span> <span class="mi">2</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-44"></a>    <span class="p">},</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-45"></a>    <span class="s1">'uat'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-46"></a>        <span class="s1">'envname'</span><span class="p">:</span> <span class="s1">'uat'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-47"></a>        <span class="s1">'user'</span><span class="p">:</span> <span class="s1">'myapp'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-48"></a>        <span class="s1">'host'</span><span class="p">:</span> <span class="s1">'uat.myapp2.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-49"></a>        <span class="s1">'host_string'</span><span class="p">:</span> <span class="s1">'uat.myapp2.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-50"></a>        <span class="s1">'key_filename'</span><span class="p">:</span> <span class="s1">'deploy/keys/id_rsa'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-51"></a>        <span class="s1">'path'</span><span class="p">:</span> <span class="s1">'/opt/myapp/uat/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-52"></a>        <span class="s1">'www_root'</span><span class="p">:</span> <span class="s1">'http://uat.myapp2.stencel.com/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-53"></a>        <span class="s1">'retries_before_killing'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-54"></a>        <span class="s1">'retry_sleep'</span><span class="p">:</span> <span class="mi">2</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-55"></a>    <span class="p">},</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-56"></a>    <span class="s1">'sit'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-57"></a>        <span class="s1">'envname'</span><span class="p">:</span> <span class="s1">'sit'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-58"></a>        <span class="s1">'user'</span><span class="p">:</span> <span class="s1">'myapp'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-59"></a>        <span class="s1">'host'</span><span class="p">:</span> <span class="s1">'sit.myapp2.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-60"></a>        <span class="s1">'host_string'</span><span class="p">:</span> <span class="s1">'sit.myapp2.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-61"></a>        <span class="s1">'key_filename'</span><span class="p">:</span> <span class="s1">'deploy/keys/id_rsa'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-62"></a>        <span class="s1">'path'</span><span class="p">:</span> <span class="s1">'/opt/myapp/sit/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-63"></a>        <span class="s1">'www_root'</span><span class="p">:</span> <span class="s1">'http://sit.myapp2.stencel.com/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-64"></a>        <span class="s1">'retries_before_killing'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-65"></a>        <span class="s1">'retry_sleep'</span><span class="p">:</span> <span class="mi">2</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-66"></a>    <span class="p">},</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-67"></a>    <span class="s1">'live'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-68"></a>        <span class="s1">'envname'</span><span class="p">:</span> <span class="s1">'live'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-69"></a>        <span class="s1">'user'</span><span class="p">:</span> <span class="s1">'myapp'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-70"></a>        <span class="s1">'host'</span><span class="p">:</span> <span class="s1">'10.10.10.10'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-71"></a>        <span class="s1">'host_string'</span><span class="p">:</span> <span class="s1">'myapp2.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-72"></a>        <span class="s1">'path'</span><span class="p">:</span> <span class="s1">'/opt/myapp/live/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-73"></a>        <span class="s1">'www_root'</span><span class="p">:</span> <span class="s1">'http://myapp2.stencel.com/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-74"></a>        <span class="s1">'retries_before_killing'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-75"></a>        <span class="s1">'retry_sleep'</span><span class="p">:</span> <span class="mi">2</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-76"></a>    <span class="p">},</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-77"></a>    <span class="s1">'live2'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-78"></a>        <span class="s1">'envname'</span><span class="p">:</span> <span class="s1">'live2'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-79"></a>        <span class="s1">'user'</span><span class="p">:</span> <span class="s1">'root'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-80"></a>        <span class="s1">'host'</span><span class="p">:</span> <span class="s1">'10.10.10.11'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-81"></a>        <span class="s1">'host_string'</span><span class="p">:</span> <span class="s1">'live2.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-82"></a>        <span class="s1">'path'</span><span class="p">:</span> <span class="s1">'/var/www/myapp/live/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-83"></a>        <span class="s1">'www_root'</span><span class="p">:</span> <span class="s1">'http://myapp2.stencel.com/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-84"></a>        <span class="s1">'retries_before_killing'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-85"></a>        <span class="s1">'retry_sleep'</span><span class="p">:</span> <span class="mi">2</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-86"></a>    <span class="p">},</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-87"></a>    <span class="s1">'live3'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-88"></a>        <span class="s1">'envname'</span><span class="p">:</span> <span class="s1">'live3'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-89"></a>        <span class="s1">'user'</span><span class="p">:</span> <span class="s1">'root'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-90"></a>        <span class="s1">'host'</span><span class="p">:</span> <span class="s1">'10.10.10.12'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-91"></a>        <span class="s1">'host_string'</span><span class="p">:</span> <span class="s1">'live3.stencel.com'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-92"></a>        <span class="s1">'path'</span><span class="p">:</span> <span class="s1">'/var/www/myapp/live/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-93"></a>        <span class="s1">'www_root'</span><span class="p">:</span> <span class="s1">'http://myapp2.stencel.com/'</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-94"></a>        <span class="s1">'retries_before_killing'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-95"></a>        <span class="s1">'retry_sleep'</span><span class="p">:</span> <span class="mi">2</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-96"></a>    <span class="p">},</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-97"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-98"></a><span class="p">}</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-99"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-100"></a><span class="n">LIVE_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'live'</span><span class="p">,</span> <span class="s1">'live2'</span><span class="p">,</span> <span class="s1">'live3'</span><span class="p">]</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-101"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-102"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-103"></a><span class="k">def</span> <span class="nf">list_hosts</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-104"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-105"></a><span class="sd">    Lists available myapp hosts</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-106"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-107"></a>    <span class="nb">print</span> <span class="s2">" Single hosts(if you want to pull from svn only to one of them):"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-108"></a>    <span class="nb">print</span> <span class="s1">'   </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">   '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">SERVERS</span><span class="p">])</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-109"></a>    <span class="nb">print</span> <span class="s2">" Multiple hosts"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-110"></a>    <span class="nb">print</span> <span class="s1">'   live (which contains </span><span class="si">%s</span><span class="s1">)'</span> <span class="o">%</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">LIVE_HOSTS</span><span class="p">])</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-111"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-112"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-113"></a><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-114"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-115"></a><span class="sd">    single host definition , "fab test restart" wil restart this one host</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-116"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-117"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-118"></a>    <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">SERVERS</span><span class="p">[</span><span class="s1">'test'</span><span class="p">]))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-119"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-120"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-121"></a><span class="k">def</span> <span class="nf">localhost</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-122"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-123"></a><span class="sd">    single host definition , "fab test restart" wil restart this one host</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-124"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-125"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-126"></a>    <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">SERVERS</span><span class="p">[</span><span class="s1">'local'</span><span class="p">]))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-127"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-128"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-129"></a><span class="k">def</span> <span class="nf">uat</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-130"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-131"></a><span class="sd">    single host definition , "fab uat restart" wil restart this single host</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-132"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-133"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-134"></a>    <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">SERVERS</span><span class="p">[</span><span class="s1">'uat'</span><span class="p">]))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-135"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-136"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-137"></a><span class="k">def</span> <span class="nf">sit</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-138"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-139"></a><span class="sd">    single host</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-140"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-141"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-142"></a>    <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">SERVERS</span><span class="p">[</span><span class="s1">'sit'</span><span class="p">]))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-143"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-144"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-145"></a><span class="c1">#  SERVERS GRcompanyS DEFINITION</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-146"></a><span class="k">def</span> <span class="nf">live</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-147"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-148"></a><span class="sd">    multiple grcompany of hosts - running: "fab live restart" will restart all live servers</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-149"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-150"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-151"></a>    <span class="n">env</span><span class="p">[</span><span class="s1">'hosts'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">SERVERS</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s1">'host'</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">LIVE_HOSTS</span><span class="p">]</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-152"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-153"></a>    <span class="c1"># env.update(dict(SERVERS['staging']))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-154"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-155"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-156"></a><span class="k">def</span> <span class="nf">env_update</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-157"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-158"></a><span class="sd">    Decorator - needs to be added to each task in fabricfile - for multiple host task execution</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-159"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-160"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-161"></a>    <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-162"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">hosts</span><span class="p">):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-163"></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-164"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-165"></a>            <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">SERVERS</span><span class="p">[</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">SERVERS</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s1">'host'</span><span class="p">]</span> <span class="o">==</span> <span class="n">env</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">MyApp_SERVERS</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-166"></a>            <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-167"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-168"></a>    <span class="k">return</span> <span class="n">func_wrapper</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-169"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-170"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-171"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-172"></a><span class="k">def</span> <span class="nf">bundle_media</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-173"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-174"></a><span class="sd">    bundles media like css and js to one file.</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-175"></a><span class="sd">    example:</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-176"></a><span class="sd">        fab test bundle_media</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-177"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-178"></a>    <span class="c1"># export DJANGO_SETTINGS_MODULE=settings</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-179"></a>    <span class="c1">#run("cd {0} &amp;&amp; source settings/{1}-config.sh &amp;&amp; python scripts/bundle_media.py".format(env.path,env.envname))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-180"></a>   <span class="n">run</span><span class="p">(</span><span class="s2">"source /usr/share/virtualenvwrapper/virtualenvwrapper.sh &amp;&amp; workon </span><span class="si">{0}</span><span class="s2"> &amp;&amp; python scripts/bundle_media.py"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">-myapp"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span> <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="o">&lt;&gt;</span> <span class="s1">'live'</span> <span class="k">else</span> <span class="s1">'MyApp-test'</span><span class="p">))</span> <span class="c1">#change live venv to be live-MyApp</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-181"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-182"></a><span class="k">def</span> <span class="nf">_valid_branch</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-183"></a>    <span class="n">branch</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="s2">"cd </span><span class="si">{0}</span><span class="s2"> &amp;&amp; git rev-parse --abbrev-ref HEAD"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-184"></a>    <span class="k">return</span> <span class="n">branch</span> <span class="o">==</span> <span class="n">SERVER_BRANCHES</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="o">==</span><span class="s1">'local'</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-185"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-186"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-187"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-188"></a><span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-189"></a>    <span class="k">if</span> <span class="n">_valid_branch</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-190"></a>        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-191"></a>            <span class="n">run</span><span class="p">(</span><span class="s2">"git fetch origin"</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-192"></a>            <span class="n">run</span><span class="p">(</span><span class="s2">"git reset --hard origin/</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">branch</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-193"></a>    <span class="k">else</span><span class="p">:</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-194"></a>        <span class="nb">print</span> <span class="s2">"Error : Server is checked out to wrong branch!!!"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-195"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-196"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-197"></a>            <span class="c1">#run('git fetch --quiet')</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-198"></a>            <span class="c1">#run('git fetch --tags --quiet')</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-199"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-200"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-201"></a><span class="k">def</span> <span class="nf">reload</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-202"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-203"></a><span class="sd">    Reload specified servers - kills unused gunicorn workers but waits workers with old code to finish processing.</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-204"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-205"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-206"></a>    <span class="n">bundle_media</span><span class="p">()</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-207"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-208"></a>    <span class="c1">#if env.envname in ('uat', 'staging', 'live'):</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-209"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-210"></a>    <span class="n">get</span><span class="p">(</span><span class="s2">"/opt/myapp/</span><span class="si">%s</span><span class="s2">/pid"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-211"></a>    <span class="n">pid</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\d+'</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-212"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"ps aux | grep gunicorn | grep </span><span class="si">%s</span><span class="s2"> | grep master | grep -v grep | awk '{print $2}'"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-213"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"kill -HUP </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">pid</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-214"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-215"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-216"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-217"></a><span class="k">def</span> <span class="nf">restart</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-218"></a>    <span class="sd">"""</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-219"></a><span class="sd">    Hard restarts specified servers</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-220"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-221"></a><span class="sd">    """</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-222"></a>    <span class="n">bundle_media</span><span class="p">()</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-223"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"ps aux | grep gunicorn | grep </span><span class="si">%s</span><span class="s2"> | grep master | grep -v grep | awk '{print $2}'"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-224"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"supervisorctl stop myapp-</span><span class="si">%s</span><span class="s2"> &amp;&amp; supervisorctl start MyApp-</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="p">,</span><span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="p">))</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-225"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"ps aux | grep gunicorn | grep </span><span class="si">%s</span><span class="s2"> | grep master | grep -v grep | awk '{print $2}'"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-226"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-227"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-228"></a><span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-229"></a>    <span class="n">fabric_functions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'run'</span><span class="p">,</span> <span class="s1">'execute'</span><span class="p">,</span> <span class="s1">'local'</span><span class="p">,</span> <span class="s1">'func_wrapper'</span><span class="p">]</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-230"></a>    <span class="n">functions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fabric_functions</span> <span class="k">else</span> <span class="s1">''</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-231"></a>                     <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">])</span> <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">obj</span><span class="p">)])</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-232"></a>    <span class="n">functions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-233"></a>    <span class="nb">print</span> <span class="s2">"usage: </span><span class="se">\n</span><span class="s2">  fab [host/grcompany of hosts] [commands] (optional command with arguments command:kwarg=val,arg1,arg2,arg3)"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-234"></a>    <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">available servers:"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-235"></a>    <span class="n">list_hosts</span><span class="p">()</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-236"></a>    <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">commands:</span><span class="se">\n</span><span class="s2">  </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">])</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-237"></a>    <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">examples:</span><span class="se">\n</span><span class="s2">  staging svnxapp:app=holdings_and_quotes,layout.py,permissions.py restart"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-238"></a>    <span class="nb">print</span> <span class="s2">"  fab test restart"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-239"></a>    <span class="nb">print</span> <span class="s2">"  fab staging svnxapp:app=holdings_and_quotes,lib/quote.py,layout.py,models.py"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-240"></a>    <span class="nb">print</span> <span class="s2">"  fab staging svnxapp:app=holdings_and_quotes,lib/quote.py restart"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-241"></a>    <span class="nb">print</span> <span class="s2">"  fab test build"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-242"></a>    <span class="nb">print</span> <span class="s2">"  fab test bundle_media restart"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-243"></a>    <span class="nb">print</span> <span class="s2">" For svnx whole app (comma in the end):"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-244"></a>    <span class="nb">print</span> <span class="s2">"  fab test svnxapp:app=medrep,"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-245"></a>    <span class="nb">print</span> <span class="s2">" For global lib:"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-246"></a>    <span class="nb">print</span> <span class="s2">"  fab test svnxlib"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-247"></a>    <span class="nb">print</span> <span class="s2">" For whole global media:"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-248"></a>    <span class="nb">print</span> <span class="s2">"  fab test svnxmedia:"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-249"></a>    <span class="nb">print</span> <span class="s2">" For global media file:"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-250"></a>    <span class="nb">print</span> <span class="s2">"  fab test svnxmedia:javascript"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-251"></a>    <span class="nb">print</span> <span class="s2">"  fab test svnxmedia:javascript/company/checklist.js"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-252"></a>    <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">If .js file in args like : fab staging svnxapp:app=holdings_and_quotes,media/js/quote.js,layout.py,models.py"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-253"></a>    <span class="nb">print</span> <span class="s2">"It will bundle media itself"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-254"></a>    <span class="nb">print</span> <span class="s2">"Restart test staging without params:</span><span class="se">\n</span><span class="s2">  fab restart"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-255"></a>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-256"></a>        <span class="nb">print</span> <span class="n">f</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-257"></a>        <span class="nb">print</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-258"></a>        <span class="nb">print</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-259"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-260"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-261"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-262"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-263"></a><span class="k">def</span> <span class="nf">accessguni</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-264"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"tail /var/log/myapp/access-</span><span class="si">%s</span><span class="s2">.log"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-265"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-266"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-267"></a><span class="k">def</span> <span class="nf">accessgunilive</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-268"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"tail -f /var/log/myapp/access-</span><span class="si">%s</span><span class="s2">.log"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-269"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-270"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-271"></a><span class="k">def</span> <span class="nf">errorguni</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-272"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"tail /var/log/myapp/error-</span><span class="si">%s</span><span class="s2">.log"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-273"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-274"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-275"></a><span class="k">def</span> <span class="nf">errorgunilive</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-276"></a>    <span class="n">run</span><span class="p">(</span><span class="s2">"tail -f /var/log/myapp/error.log"</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">envname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-277"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-278"></a><span class="k">def</span> <span class="nf">hostname</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-279"></a>    <span class="n">run</span><span class="p">(</span><span class="s1">'uname -a'</span><span class="p">)</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-280"></a>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-281"></a><span class="nd">@env_update</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-282"></a><span class="k">def</span> <span class="nf">uptime</span><span class="p">():</span>
<a name="rest_code_5025a06c642341c2b8e8c0674d26a9ba-283"></a>    <span class="n">run</span><span class="p">(</span><span class="s1">'uptime'</span><span class="p">)</span>
</pre>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-4.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="stencel";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2021         <a href="mailto:gstencel@gmail.com">Greg Stencel</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50641127-1', 'stencel.io');
  ga('send', 'pageview');

</script><script type="text/javascript" src="assets/js/tipuesearch_set.js"></script><script type="text/javascript" src="assets/js/tipuesearch.js"></script><script type="text/javascript">
$(document).ready(function() {
     $('#tipue_search_input').tipuesearch({
         'mode': 'json',
         'contentLocation': '/assets/js/tipuesearch_content.json',
         'showUrl': false
     });
});
</script>
</body>
</html>
